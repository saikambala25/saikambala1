<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>saikambala - own website</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <style>
    :root {
      --primary-color: #2563eb;
      --secondary-color: #06b6d4;
      --accent-color: #fbbf24;
      --danger-color: #ef4444;
      --background-color: #f8fafc;
      --text-color: #1e293b;
      --tab-background: #e0e7ef;
      --tab-text-color: #64748b;
      --tab-heading-color: #334155;
      --content-background: #ffffff;
      --file-upload-background: #f1f5f9;
      --file-item-background: #e0e7ef;
      --shadow: 0 4px 12px rgba(37, 99, 235, 0.08);
      --shadow-hover: 0 8px 24px rgba(37, 99, 235, 0.12);
      --transition: all 0.3s cubic-bezier(.4,0,.2,1);
    }
    /* Dark Mode */
    body.dark-mode {
      --primary-color: #60a5fa;
      --secondary-color: #22d3ee;
      --accent-color: #fde68a;
      --danger-color: #f87171;
      --background-color: #0f172a;
      --text-color: #f1f5f9;
      --tab-background: #1e293b;
      --tab-text-color: #94a3b8;
      --tab-heading-color: #f1f5f9;
      --content-background: #1e293b;
      --file-upload-background: #1e293b;
      --file-item-background: #334155;
      --shadow: 0 4px 12px rgba(96, 165, 250, 0.10);
      --shadow-hover: 0 8px 24px rgba(96, 165, 250, 0.18);
    }
    body.no-animations * {
      transition: none !important;
      animation: none !important;
    }
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: var(--background-color);
      color: var(--text-color);
      height: 100vh;
      position: relative;
      transition: var(--transition);
      overflow-x: hidden;
    }

    /* ================= LOGIN PORTAL â€“ LIQUID GRADIENT BLOB ================= */
    .login-portal-overlay {
      position: fixed;
      inset: 0;
      z-index: 9999;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      background: radial-gradient(circle at top, #0f172a 0%, #020617 50%, #020617 100%);
      transition: opacity 0.6s ease, transform 0.6s ease;
      opacity: 0;
      pointer-events: none;
    }

    /* Shown when not logged in */
    #loginPortal.active {
      opacity: 1;
      pointer-events: auto;
      transform: scale(1);
    }

    /* When body has logged-in, we fade it away nicely */
    body.logged-in #loginPortal {
      opacity: 0;
      pointer-events: none;
      transform: translateY(-20px) scale(0.98);
    }

    .login-portal-bg {
      position: absolute;
      inset: 0;
      background:
        radial-gradient(circle at top left, rgba(56, 189, 248, 0.25), transparent 55%),
        radial-gradient(circle at bottom right, rgba(248, 113, 113, 0.25), transparent 60%);
      opacity: 0.9;
    }

    /* Layout */
    .login-portal-inner {
      position: relative;
      width: 100%;
      max-width: 960px;
      padding: 1.5rem;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* Liquid Gradient Blob */
    .login-blob {
      position: absolute;
      width: 460px;
      height: 460px;
      background: linear-gradient(
        135deg,
        #ff9a9e,
        #fad0c4,
        #fbc2eb,
        #a1c4fd,
        #cbb2fe
      );
      background-size: 200% 200%;
      border-radius: 40% 60% 65% 35% / 45% 35% 55% 65%;
      filter: blur(0);
      opacity: 0.85;
      transform: translate3d(-15%, -5%, 0);
      animation:
        login-blob-morph 18s ease-in-out infinite alternate,
        login-blob-move 22s ease-in-out infinite alternate,
        login-blob-gradient 16s ease-in-out infinite alternate;
      box-shadow:
        0 0 60px rgba(251, 113, 133, 0.35),
        0 0 120px rgba(59, 130, 246, 0.35);
    }

    /* Glassmorphism card */
    .login-card {
      position: relative;
      z-index: 1;
      width: 100%;
      max-width: 420px;
      padding: 2.3rem 2.5rem 2rem;
      border-radius: 26px;
      background: linear-gradient(
          135deg,
          rgba(15, 23, 42, 0.8),
          rgba(15, 23, 42, 0.35)
        ),
        radial-gradient(circle at top left, rgba(96, 165, 250, 0.25), transparent 55%);
      border: 1px solid rgba(148, 163, 184, 0.4);
      box-shadow:
        0 24px 60px rgba(15, 23, 42, 0.9),
        0 0 0 1px rgba(148, 163, 184, 0.35);
      backdrop-filter: blur(28px) saturate(130%);
      -webkit-backdrop-filter: blur(28px) saturate(130%);
      color: #e5e7eb;
      transform: translateY(10px) scale(0.98);
      opacity: 0;
      animation: login-card-in 0.9s ease forwards 0.1s;
    }

    /* Header */
    .login-card-header {
      display: flex;
      align-items: center;
      gap: 1.25rem;
      margin-bottom: 1.75rem;
    }

    .login-logo-circle {
      width: 52px;
      height: 52px;
      border-radius: 999px;
      background: radial-gradient(circle at 30% 30%, #fef3c7, #f97316);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow:
        0 12px 32px rgba(248, 113, 22, 0.6),
        0 0 0 1px rgba(255, 255, 255, 0.35);
    }

    .login-logo-letter {
      font-weight: 800;
      font-size: 1.5rem;
      color: #0b1120;
    }

    .login-title-group {
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
    }

    .login-title {
      margin: 0;
      font-size: 1.55rem;
      font-weight: 700;
      letter-spacing: 0.02em;
    }

    .login-subtitle {
      margin: 0;
      font-size: 0.9rem;
      color: #9ca3af;
    }

    /* Form */
    .login-form {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .login-form-group {
      display: flex;
      flex-direction: column;
      gap: 0.4rem;
    }

    .login-label {
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: #9ca3af;
    }

    .login-input-wrapper {
      position: relative;
      display: flex;
      align-items: center;
      background: radial-gradient(circle at top left, rgba(15, 23, 42, 0.85), rgba(15, 23, 42, 0.7));
      border-radius: 999px;
      padding-inline: 0.9rem 0.9rem;
      border: 1px solid rgba(148, 163, 184, 0.45);
      box-shadow: 0 0 0 1px rgba(15, 23, 42, 0.6);
      transition: all 0.2s ease;
    }

    .login-input-wrapper:focus-within {
      border-color: rgba(59, 130, 246, 0.9);
      box-shadow:
        0 0 0 1px rgba(59, 130, 246, 0.9),
        0 0 25px rgba(37, 99, 235, 0.35);
      transform: translateY(-1px);
    }

    .login-input-icon {
      font-size: 0.85rem;
      color: #9ca3af;
      margin-right: 0.5rem;
    }

    .login-input {
      flex: 1;
      border: none;
      outline: none;
      background: transparent;
      color: #e5e7eb;
      font-size: 0.95rem;
      padding-block: 0.6rem;
    }

    .login-input::placeholder {
      color: #6b7280;
    }

    /* Password eye toggle */
    .login-toggle-password {
      border: none;
      outline: none;
      background: transparent;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-left: 0.35rem;
      font-size: 0.9rem;
      color: #9ca3af;
      transition: transform 0.18s ease, color 0.18s ease, opacity 0.18s ease;
    }

    .login-toggle-password:hover {
      transform: scale(1.05) translateY(-1px);
      color: #e5e7eb;
    }

    .login-toggle-password.active i {
      color: #22c55e;
    }

    /* Hint + button */
    .login-meta-row {
      display: flex;
      justify-content: flex-start;
      margin-top: 0.2rem;
      margin-bottom: 0.4rem;
    }

    .login-hint {
      font-size: 0.8rem;
      color: #9ca3af;
    }

    /* Login button */
    .btn.btn-login-primary {
      margin-top: 0.4rem;
      width: 100%;
      border-radius: 999px;
      border: none;
      outline: none;
      cursor: pointer;
      padding: 0.7rem 1.1rem;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      background: linear-gradient(135deg, #22c55e, #16a34a);
      color: #022c22;
      font-weight: 600;
      font-size: 0.98rem;
      letter-spacing: 0.03em;
      box-shadow:
        0 16px 40px rgba(16, 185, 129, 0.6),
        0 0 0 1px rgba(52, 211, 153, 0.6);
      transition:
        transform 0.14s ease,
        box-shadow 0.14s ease,
        filter 0.14s ease,
        background 0.14s ease;
    }

    .btn.btn-login-primary:hover {
      transform: translateY(-1px) scale(1.01);
      box-shadow:
        0 20px 50px rgba(16, 185, 129, 0.8),
        0 0 0 1px rgba(52, 211, 153, 0.8);
      filter: brightness(1.03);
    }

    .btn.btn-login-primary:active {
      transform: translateY(0) scale(0.99);
      box-shadow:
        0 10px 25px rgba(16, 185, 129, 0.7),
        0 0 0 1px rgba(52, 211, 153, 0.7);
    }

    .btn-login-icon {
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }

    .btn-login-icon i {
      transition: transform 0.16s ease;
    }

    .btn.btn-login-primary:hover .btn-login-icon i {
      transform: translateX(3px);
    }

    /* Footer small pill */
    .login-footer-text {
      margin-top: 1.2rem;
      display: flex;
      justify-content: flex-start;
    }

    .login-footer-pill {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.3rem 0.7rem;
      border-radius: 999px;
      background: linear-gradient(
        135deg,
        rgba(30, 64, 175, 0.7),
        rgba(6, 95, 70, 0.85)
      );
      font-size: 0.75rem;
      color: #d1fae5;
      box-shadow:
        0 12px 25px rgba(15, 23, 42, 0.9),
        0 0 0 1px rgba(22, 163, 74, 0.4);
    }

    .login-footer-pill .dot {
      width: 7px;
      height: 7px;
      border-radius: 999px;
      background-color: #22c55e;
      box-shadow: 0 0 10px rgba(34, 197, 94, 0.8);
    }

    /* Animations */
    @keyframes login-blob-morph {
      0% {
        border-radius: 40% 60% 65% 35% / 45% 35% 55% 65%;
      }
      25% {
        border-radius: 70% 30% 45% 55% / 35% 65% 35% 65%;
      }
      50% {
        border-radius: 55% 45% 30% 70% / 60% 40% 70% 40%;
      }
      75% {
        border-radius: 35% 65% 70% 30% / 55% 45% 35% 65%;
      }
      100% {
        border-radius: 40% 60% 65% 35% / 45% 35% 55% 65%;
      }
    }

    @keyframes login-blob-move {
      0% {
        transform: translate3d(-15%, -5%, 0) scale(1);
      }
      50% {
        transform: translate3d(5%, 8%, 0) scale(1.08);
      }
      100% {
        transform: translate3d(-10%, 10%, 0) scale(0.98);
      }
    }

    @keyframes login-blob-gradient {
      0% {
        background-position: 0% 50%;
      }
      50% {
        background-position: 100% 50%;
      }
      100% {
        background-position: 0% 50%;
      }
    }

    @keyframes login-card-in {
      0% {
        opacity: 0;
        transform: translateY(18px) scale(0.96);
      }
      100% {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    /* Responsive tweaks */
    @media (max-width: 768px) {
      .login-portal-inner {
        padding-inline: 1.2rem;
      }
      .login-card {
        padding: 1.9rem 1.6rem 1.6rem;
        max-width: 100%;
      }
      .login-blob {
        width: 360px;
        height: 360px;
        transform: translate3d(-5%, -10%, 0);
      }
      .login-title {
        font-size: 1.35rem;
      }
    }

    /* --- HIDE MAIN APP UNTIL LOGGED IN --- */
    .app-container {
      display: none;
    }
    body.logged-in .app-container {
      display: flex;
    }
    body.logged-in .login-portal-overlay {
      display: none;
    }
    .app-container {
      height: 100vh;
    }
    .sidebar {
      width: 250px;
      background-color: var(--tab-background);
      box-shadow: var(--shadow);
      transition: var(--transition);
      z-index: 10;
      display: flex;
      flex-direction: column;
      overflow-x: hidden;
    }
    .sidebar.collapsed {
      width: 70px;
    }
    .sidebar-header {
      padding: 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      border-bottom: 1px solid rgba(0,0,0,0.1);
    }
    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
      font-weight: bold;
      font-size: 1.2rem;
      color: var(--primary-color);
    }
    .sidebar.collapsed .logo-text {
      display: none;
    }
    .toggle-sidebar {
      background: none;
      border: none;
      color: var(--text-color);
      cursor: pointer;
      font-size: 1.2rem;
      transition: var(--transition);
    }
    .toggle-sidebar:hover {
      color: var(--primary-color);
      transform: scale(1.1);
    }
    .nav-menu {
      flex: 1;
      padding: 20px 0;
      overflow-y: auto;
    }
    .nav-item {
      display: flex;
      align-items: center;
      padding: 12px 20px;
      color: var(--tab-text-color);
      text-decoration: none;
      transition: var(--transition);
      position: relative;
    }
    .nav-item i {
      margin-right: 15px;
      font-size: 1.2rem;
      width: 20px;
      text-align: center;
    }
    .nav-item span {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: clip;
      transition: opacity 0.2s;
      display: inline-block;
    }
    .sidebar.collapsed .nav-item span {
      display: none;
    }
    .sidebar.collapsed .nav-item {
      justify-content: center;
    }
    .sidebar.collapsed .nav-item i {
      margin-right: 0;
    }
    .nav-item:hover {
      background-color: rgba(47, 132, 124, 0.1);
      color: var(--primary-color);
    }
    .nav-item.active {
      background-color: rgba(47, 132, 124, 0.2);
      color: var(--primary-color);
    }
    .nav-item.active::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0;
      height: 100%;
      width: 4px;
      background-color: var(--primary-color);
    }
    .main-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }
    .top-bar {
      height: 70px;
      background-color: var(--tab-background);
      box-shadow: var(--shadow);
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 30px;
      z-index: 5;
    }
    .search-container {
      position: relative;
      width: 40%;
      max-width: 500px;
    }
    .search-input {
      width: 100%;
      padding: 10px 40px 10px 15px;
      border: 2px solid rgba(0,0,0,0.1);
      border-radius: 30px;
      background-color: var(--file-upload-background);
      color: var(--text-color);
      font-size: 0.9rem;
      transition: var(--transition);
    }
    .search-input:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.2);
    }
    /* Dark mode specific search input styling */
    body.dark-mode .search-input {
      border-color: rgba(255,255,255,0.1);
    }
    body.dark-mode .search-input:focus {
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(96, 165, 250, 0.2);
    }
    .search-button {
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      background: none;
      border: none;
      color: var(--tab-text-color);
      cursor: pointer;
    }
    .search-results {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background-color: var(--content-background);
      border-radius: 10px;
      box-shadow: var(--shadow-hover);
      max-height: 400px;
      overflow-y: auto;
      z-index: 100;
      margin-top: 10px;
      display: none;
    }
    .search-results.active {
      display: block;
    }
    .search-result-item {
      padding: 12px 15px;
      border-bottom: 1px solid rgba(0,0,0,0.05);
      cursor: pointer;
      transition: var(--transition);
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .search-result-item:hover {
      background-color: var(--file-upload-background);
    }
    .search-result-item:last-child {
      border-bottom: none;
    }
    .search-result-icon {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      background-color: var(--file-item-background);
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--primary-color);
      flex-shrink: 0;
    }
    .search-result-content {
      flex: 1;
      overflow: hidden;
    }
    .search-result-title {
      font-weight: 500;
      margin-bottom: 3px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    .search-result-type {
      font-size: 0.8rem;
      color: var(--tab-text-color);
    }
    .search-no-results {
      padding: 15px;
      text-align: center;
      color: var(--tab-text-color);
    }
    .top-bar-actions {
      display: flex;
      align-items: center;
      gap: 15px;
    }
    .icon-button {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background-color: var(--file-upload-background);
      border: none;
      color: var(--text-color);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: var(--transition);
    }
    .icon-button:hover {
      background-color: var(--primary-color);
      color: white;
      transform: scale(1.1);
    }
    .user-profile-dropdown {
      position: relative;
    }
    .user-profile-btn {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background-color: var(--file-upload-background);
      border: none;
      color: var(--text-color);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: var(--transition);
      position: relative;
    }
    .user-profile-btn:hover {
      background-color: var(--primary-color);
      color: white;
      transform: scale(1.1);
    }
    .user-profile-btn img {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      object-fit: cover;
    }
    .user-profile-menu {
      position: absolute;
      top: 100%;
      right: 0;
      background-color: var(--content-background);
      border-radius: 10px;
      box-shadow: var(--shadow-hover);
      min-width: 200px;
      z-index: 100;
      margin-top: 10px;
      display: none;
      overflow: hidden;
    }
    .user-profile-menu.active {
      display: block;
    }
    .user-profile-menu-item {
      padding: 12px 16px;
      display: flex;
      align-items: center;
      gap: 12px;
      cursor: pointer;
      transition: var(--transition);
      color: var(--text-color);
      text-decoration: none;
      border-bottom: 1px solid rgba(0,0,0,0.05);
    }
    .user-profile-menu-item:hover {
      background-color: var(--file-upload-background);
    }
    .user-profile-menu-item:last-child {
      border-bottom: none;
    }
    .user-profile-menu-item i {
      width: 20px;
      text-align: center;
    }
    .user-profile-menu-item.danger {
      color: var(--danger-color);
    }
    .user-profile-menu-item.danger:hover {
      background-color: rgba(239, 68, 68, 0.1);
    }
    .content-area {
      flex: 1;
      padding: 30px;
      overflow-y: auto;
      background-color: var(--background-color);
    }
    .page-content {
      display: none;
      height: 100%;
    }
    .page-content.active {
      display: block;
    }
    .page-header {
      margin-bottom: 30px;
    }
    .page-title {
      font-size: 2rem;
      margin-bottom: 10px;
      color: var(--tab-heading-color);
    }
    .page-subtitle {
      color: var(--tab-text-color);
    }
    .card {
      background-color: var(--content-background);
      border-radius: 10px;
      box-shadow: var(--shadow);
      padding: 25px;
      margin-bottom: 20px;
      transition: var(--transition);
    }
    .card:hover {
      box-shadow: var(--shadow-hover);
      transform: translateY(-5px);
    }
    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid rgba(0,0,0,0.1);
    }
    .card-title {
      font-size: 1.3rem;
      font-weight: 600;
      color: var(--tab-heading-color);
    }
    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-weight: 500;
      transition: var(--transition);
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }
    .btn-sm {
      padding: 5px 10px;
      font-size: 0.8rem;
    }
    .btn-primary {
      background-color: var(--primary-color);
      color: white;
    }
    .btn-primary:hover {
      background-color: #236b65;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    .btn-secondary {
      background-color: var(--secondary-color);
      color: white;
    }
    .btn-secondary:hover {
      background-color: #4a8ad8;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    .btn-danger {
      background-color: var(--danger-color);
      color: white;
    }
    .btn-danger:hover {
      background-color: #b00606;
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    .btn-outline {
      background-color: transparent;
      border: 1px solid var(--primary-color);
      color: var(--primary-color);
    }
    .btn-outline:hover {
      background-color: var(--primary-color);
      color: white;
    }
    .file-upload-area {
      border: 2px dashed var(--primary-color);
      border-radius: 10px;
      padding: 40px;
      text-align: center;
      margin: 20px 0;
      background-color: var(--file-upload-background);
      transition: var(--transition);
      cursor: pointer;
    }
    .file-upload-area:hover {
      background-color: rgba(47, 132, 124, 0.1);
      transform: scale(1.02);
    }
    .file-list {
      margin-top: 20px;
    }
    .file-item {
      background: var(--file-item-background);
      padding: 15px;
      margin-bottom: 10px;
      border-radius: 8px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      color: var(--text-color);
      transition: var(--transition);
      position: relative;
    }
    .file-item:hover {
      transform: translateX(5px);
      box-shadow: var(--shadow);
    }
    .item-checkbox {
      width: 20px;
      height: 20px;
      flex-shrink: 0;
      cursor: pointer;
      margin-right: 15px;
      display: none;
    }
    .selection-mode-active .file-item {
      align-items: center;
    }
    .selection-mode-active .file-item .item-checkbox,
    .selection-mode-active .project-card .item-checkbox {
      display: block;
    }
    .selection-mode-active .project-card .item-checkbox {
      position: absolute;
      top: 10px;
      right: 10px;
      z-index: 10;
      margin-right: 0;
      accent-color: white;
      transform: scale(1.3);
    }
    .file-list.grid-view.selection-mode-active .file-item .item-checkbox,
    .file-list.grid-view.selection-mode-active .project-card .item-checkbox {
      position: absolute;
      top: 15px;
      right: 15px;
      z-index: 10;
      margin-right: 0;
    }
    .file-list.grid-view.selection-mode-active .project-card .item-checkbox {
      transform: scale(1.3);
    }
    .file-info {
      display: flex;
      align-items: center;
      gap: 15px;
      flex-grow: 1;
    }
    .file-icon {
      width: 40px;
      height: 40px;
      border-radius: 8px;
      background-color: var(--primary-color);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .file-details h4 {
      margin-bottom: 5px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      flex-shrink: 1;
    }
    .file-details p {
      font-size: 0.8rem;
      color: var(--tab-text-color);
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      flex-shrink: 1;
    }
    .file-actions {
      display: flex;
      gap: 10px;
      flex-shrink: 0;
    }
    .icon-btn {
      width: 35px;
      height: 35px;
      border-radius: 50%;
      background-color: transparent;
      border: none;
      color: var(--tab-text-color);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: var(--transition);
    }
    .icon-btn:hover {
      background-color: var(--primary-color);
      color: white;
      transform: scale(1.1);
    }
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: var(--transition);
    }
    .modal-overlay.active {
      opacity: 1;
      visibility: visible;
    }
    .modal {
      background-color: var(--content-background);
      border-radius: 10px;
      width: 90%;
      max-width: 600px;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: var(--shadow-hover);
      transform: scale(0.8);
      transition: var(--transition);
    }
    #viewContentModal .modal {
      max-width: 800px;
    }
    .modal-overlay.active .modal {
      transform: scale(1);
    }
    .modal-header {
      padding: 20px;
      border-bottom: 1px solid rgba(0,0,0,0.1);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .modal-title {
      font-size: 1.5rem;
      font-weight: 600;
      color: var(--tab-heading-color);
    }
    .modal-close {
      background: none;
      border: none;
      font-size: 1.5rem;
      color: var(--tab-text-color);
      cursor: pointer;
      transition: var(--transition);
    }
    .modal-close:hover {
      color: var(--danger-color);
      transform: rotate(90deg);
    }
    .modal-body {
      padding: 20px;
    }
    .form-group {
      margin-bottom: 20px;
    }
    .form-label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: var(--tab-heading-color);
    }
    .form-input {
      width: 100%;
      padding: 12px;
      border: 1px solid rgba(0,0,0,0.1);
      border-radius: 5px;
      background-color: var(--file-upload-background);
      color: var(--text-color);
      font-size: 1rem;
      transition: var(--transition);
    }
    .form-input:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(47, 132, 124, 0.2);
    }
    .form-textarea {
      min-height: 150px;
      resize: vertical;
    }
    .toast {
      position: fixed;
      bottom: 30px;
      right: 30px;
      background-color: var(--content-background);
      color: var(--text-color);
      padding: 15px 20px;
      border-radius: 5px;
      box-shadow: var(--shadow-hover);
      display: flex;
      align-items: center;
      gap: 10px;
      max-width: 400px;
      word-wrap: break-word;
      transform: translateX(450px);
      transition: var(--transition);
      z-index: 2000;
    }
    .toast.show {
      transform: translateX(0);
    }
    .toast.success {
      border-left: 4px solid #4caf50;
    }
    .toast.error {
      border-left: 4px solid var(--danger-color);
    }
    .toast.info {
      border-left: 4px solid var(--secondary-color);
    }
    .empty-state {
      text-align: center;
      padding: 40px;
      color: var(--tab-text-color);
    }
    .empty-state i {
      font-size: 4rem;
      margin-bottom: 20px;
      opacity: 0.5;
    }
    .empty-state h3 {
      margin-bottom: 10px;
    }
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    .stat-card {
      background-color: var(--content-background);
      border-radius: 10px;
      padding: 20px;
      box-shadow: var(--shadow);
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      gap: 15px;
      transition: var(--transition);
      cursor: pointer;
    }
    .stat-card:hover {
      transform: translateY(-5px);
      box-shadow: var(--shadow-hover);
    }
    .stat-details-row {
      display: flex;
      align-items: center;
      width: 100%;
      gap: 15px;
    }
    .stat-actions {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }
    .stat-icon {
      width: 50px;
      height: 50px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.5rem;
      flex-shrink: 0;
    }
    .stat-icon.primary {
      background-color: rgba(47, 132, 124, 0.2);
      color: var(--primary-color);
    }
    .stat-icon.secondary {
      background-color: rgba(95, 157, 240, 0.2);
      color: var(--secondary-color);
    }
    .stat-icon.danger {
      background-color: rgba(208, 7, 7, 0.2);
      color: var(--danger-color);
    }
    .stat-icon.accent {
      background-color: rgba(251, 191, 36, 0.2);
      color: var(--accent-color);
    }
    .stat-details h3 {
      font-size: 1.8rem;
      margin-bottom: 5px;
    }
    .stat-details p {
      color: var(--tab-text-color);
      font-size: 0.9rem;
    }
    .tabs {
      display: flex;
      border-bottom: 1px solid rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    .tab {
      padding: 12px 20px;
      cursor: pointer;
      border-bottom: 2px solid transparent;
      transition: var(--transition);
    }
    .tab:hover {
      color: var(--primary-color);
    }
    .tab.active {
      color: var(--primary-color);
      border-bottom-color: var(--primary-color);
    }
    .tab-content {
      display: none;
    }
    .tab-content.active {
      display: block;
    }
    .code-editor {
      background-color: #282c34;
      color: #abb2bf;
      padding: 20px;
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      font-size: 0.9rem;
      line-height: 1.5;
      overflow-x: auto;
      white-space: pre-wrap;
    }
    .modal-content-area {
      max-height: 60vh;
      overflow-y: auto;
      padding: 10px;
      background-color: var(--file-upload-background);
      border-radius: 5px;
    }
    .modal-item-meta {
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 1px solid rgba(0,0,0,0.1);
      font-size: 0.9rem;
      color: var(--tab-text-color);
    }
    .modal-item-meta strong {
      color: var(--text-color);
    }
    #projectsList.file-list {
      padding-top: 10px;
    }
    #projectsList.grid-view {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
      margin-top: 0;
    }
    .project-card {
      background-color: var(--content-background);
      border-radius: 10px;
      overflow: hidden;
      box-shadow: var(--shadow);
      transition: var(--transition);
      margin-bottom: 10px;
    }
    .file-list:not(.grid-view) .project-card {
      margin-bottom: 20px;
    }
    .project-card:hover {
      transform: translateY(-5px);
      box-shadow: var(--shadow-hover);
    }
    .project-header {
      height: 120px;
      background-color: var(--primary-color);
      position: relative;
    }
    .project-title {
      position: absolute;
      bottom: 15px;
      left: 20px;
      color: white;
      font-size: 1.2rem;
      font-weight: 600;
    }
    .project-body {
      padding: 20px;
    }
    .project-description {
      color: var(--tab-text-color);
      margin-bottom: 15px;
    }
    .project-meta {
      display: flex;
      justify-content: space-between;
      font-size: 0.8rem;
      color: var(--tab-text-color);
    }
    .project-actions {
      margin-top: 15px;
      display: flex;
      gap: 10px;
    }
    #projectsList.grid-view .project-card .project-actions {
      flex-wrap: wrap;
    }
    .settings-section {
      margin-bottom: 30px;
    }
    .settings-title {
      font-size: 1.2rem;
      margin-bottom: 15px;
      color: var(--tab-heading-color);
    }
    .settings-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 0;
      border-bottom: 1px solid rgba(0,0,0,0.1);
    }
    .settings-item:last-child {
      border-bottom: none;
    }
    .switch {
      position: relative;
      display: inline-block;
      width: 50px;
      height: 24px;
    }
    .switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }
    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #ccc;
      transition: var(--transition);
      border-radius: 24px;
    }
    .slider:before {
      position: absolute;
      content: "";
      height: 18px;
      width: 18px;
      left: 3px;
      bottom: 3px;
      background-color: white;
      transition: var(--transition);
      border-radius: 50%;
    }
    input:checked + .slider {
      background-color: var(--primary-color);
    }
    input:checked + .slider:before {
      transform: translateX(26px);
    }
    .view-toggle {
      display: flex;
      gap: 10px;
      align-items: center;
    }
    .view-btn {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background-color: var(--file-upload-background);
      border: none;
      color: var(--text-color);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: var(--transition);
    }
    .view-btn:hover, .view-btn.active {
      background-color: var(--primary-color);
      color: white;
    }
    .file-list.grid-view {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 15px;
    }
    .file-list.grid-view .file-item {
      flex-direction: column;
      align-items: flex-start;
      padding: 15px;
      height: 100%;
      justify-content: flex-start;
    }
    .file-list.grid-view .file-item .file-info {
      width: 100%;
      margin-bottom: 10px;
    }
    .file-list.grid-view .file-item .file-actions {
      margin-top: auto;
      width: 100%;
      justify-content: space-between;
      display: flex;
      gap: 5px;
      padding-top: 10px;
      border-top: 1px solid rgba(0,0,0,0.05);
    }
    .file-list.grid-view .file-item .file-actions .icon-btn {
      flex-grow: 1;
      border-radius: 5px;
      width: auto;
      height: 30px;
      background-color: var(--file-upload-background);
      color: var(--text-color);
    }
    .file-list.grid-view .file-item .file-actions .icon-btn:hover {
      background-color: var(--primary-color);
      color: white;
    }
    #projectsList.grid-view .project-card {
      margin-bottom: 0;
    }
    #projectsList.grid-view .project-card .project-actions .btn {
      flex-grow: 1;
      text-align: center;
    }
    .file-list.grid-view .file-item:hover {
      transform: none;
      transform: translateY(-3px);
    }
    .grid-item {
      background: var(--file-item-background);
      border-radius: 8px;
      padding: 15px;
      display: flex;
      flex-direction: column;
      transition: var(--transition);
    }
    .select-dropdown-container {
      position: relative;
    }
    .select-dropdown-menu {
      position: absolute;
      top: calc(100% + 5px);
      right: 0;
      background-color: var(--content-background);
      border-radius: 5px;
      box-shadow: var(--shadow-hover);
      min-width: 200px;
      z-index: 100;
      overflow: hidden;
      display: none;
    }
    .select-dropdown-menu.active {
      display: block;
    }
    .select-dropdown-item {
      display: block;
      padding: 10px 15px;
      color: var(--text-color);
      text-decoration: none;
      font-size: 0.9rem;
      transition: var(--transition);
      cursor: pointer;
    }
    .select-dropdown-item:hover {
      background-color: var(--file-upload-background);
    }
    .select-dropdown-item.danger {
      color: var(--danger-color);
    }
    .select-dropdown-item.danger:hover {
      background-color: rgba(239, 68, 68, 0.1);
    }
    #confirmationModal .modal {
      max-width: 400px;
    }
    #confirmationModal .modal-body {
      text-align: center;
    }
    #confirmationModal .modal-body p {
      margin-bottom: 20px;
    }
    @media (max-width: 768px) {
      .sidebar {
        position: fixed;
        left: -250px;
        height: 100%;
        z-index: 1000;
      }
      .sidebar.active {
        left: 0;
      }
      .main-content {
        margin-left: 0;
      }
      .search-container {
        width: 100%;
      }
      .stats-grid {
        grid-template-columns: 1fr;
      }
      .project-grid {
        grid-template-columns: 1fr;
      }
      .grid-view {
        grid-template-columns: 1fr;
      }
      .toast {
        max-width: 90%;
        right: 5%;
      }
    }
  </style>
</head>
<body>
  <div class="modal-overlay" id="confirmationModal">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title" id="confirmationModalTitle">Confirm Action</h3>
        <button class="modal-close" onclick="confirmationModal.classList.remove('active')">&times;</button>
      </div>
      <div class="modal-body">
        <p id="confirmationModalMessage">Are you sure you want to proceed?</p>
        <div style="display: flex; gap: 10px; justify-content: center;">
          <button class="btn btn-danger" id="confirmYesBtn">
            <i class="fas fa-check"></i> Yes
          </button>
          <button class="btn btn-outline" onclick="confirmationModal.classList.remove('active')">
            <i class="fas fa-times"></i> No
          </button>
        </div>
      </div>
    </div>
  </div>
  <div class="modal-overlay" id="editItemModal">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title" id="editItemModalTitle">Edit Item</h3>
        <button class="modal-close" onclick="editItemModal.classList.remove('active')">&times;</button>
      </div>
      <div class="modal-body">
        <div id="editItemFormContainer"></div>
        <div style="display: flex; gap: 10px; margin-top: 20px;">
          <button class="btn btn-primary" id="saveEditItemBtn">
            <i class="fas fa-save"></i> Save Changes
          </button>
          <button class="btn btn-outline" onclick="editItemModal.classList.remove('active')">
            <i class="fas fa-times"></i> Cancel
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- ================= LOGIN PORTAL (NEW PREMIUM DESIGN) ================= -->
  <div id="loginPortal" class="login-portal-overlay">
    <div class="login-portal-bg"></div>

    <div class="login-portal-inner">
      <!-- Liquid Gradient Blob -->
      <div class="login-blob"></div>

      <!-- Glassmorphism Login Card -->
      <div class="login-card">
        <div class="login-card-header">
          <div class="login-logo-circle">
            <span class="login-logo-letter">S</span>
          </div>
          <div class="login-title-group">
            <h1 class="login-title">Welcome back</h1>
            <p class="login-subtitle">Sign in to continue to your workspace</p>
          </div>
        </div>

        <form class="login-form" onsubmit="return false;">
          <!-- Username -->
          <div class="login-form-group">
            <label for="loginEmail" class="login-label">Username</label>
            <div class="login-input-wrapper">
              <i class="fas fa-user login-input-icon"></i>
              <input
                type="text"
                id="loginEmail"
                class="login-input"
                placeholder="Enter your username"
                autocomplete="off"
              />
            </div>
          </div>

          <!-- Password -->
          <div class="login-form-group">
            <label for="loginPassword" class="login-label">Password</label>
            <div class="login-input-wrapper">
              <i class="fas fa-lock login-input-icon"></i>
              <input
                type="password"
                id="loginPassword"
                class="login-input"
                placeholder="Enter your password"
                autocomplete="off"
              />
              <button type="button" id="passwordToggle" class="login-toggle-password" aria-label="Show or hide password">
                <i class="fas fa-eye"></i>
              </button>
            </div>
          </div>
          <button type="button" id="loginSubmitBtn" class="btn btn-login-primary">
            <span class="btn-login-label">Sign in</span>
            <span class="btn-login-icon">
              <i class="fas fa-arrow-right"></i>
            </span>
          </button>
        </form>

        <div class="login-footer-text">
          <span class="login-footer-pill">
            <span class="dot"></span>
            Secure dashboard access
          </span>
        </div>
      </div>
    </div>
  </div>
  <!-- ================= END LOGIN PORTAL ================= -->

  <div class="modal-overlay" id="viewContentModal">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title" id="viewContentModalTitle">Content Viewer</h3>
        <button class="modal-close" onclick="viewContentModal.classList.remove('active')">&times;</button>
      </div>
      <div class="modal-body">
        <div id="viewContentModalMeta" class="modal-item-meta"></div>
        <div class="modal-content-area">
          <pre class="code-editor" id="viewContentModalBody"></pre>
        </div>
      </div>
    </div>
  </div>
  <div class="toast" id="toast">
    <i id="toastIcon"></i>
    <span id="toastMessage"></span>
  </div>
  <div class="app-container">
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <div class="logo">
          <span class="logo-text">SAIKAMBALA06</span>
        </div>
        <button class="toggle-sidebar" id="toggleSidebar">
          <i class="fas fa-bars"></i>
        </button>
      </div>
      <nav class="nav-menu">
        <a href="#" class="nav-item active" data-page="dashboard" onclick="resetSelectionMode()" onclick="resetSelectionMode()">
          <i class="fas fa-home"></i>
          <span>Dashboard</span>
        </a>
        <a href="#" class="nav-item" data-page="files">
          <i class="fas fa-folder"></i>
          <span>Files</span>
        </a>
        <a href="#" class="nav-item" data-page="notes">
          <i class="fas fa-sticky-note"></i>
          <span>Notes</span>
        </a>
        <a href="#" class="nav-item" data-page="projects">
          <i class="fas fa-project-diagram"></i>
          <span>Projects</span>
        </a>
        <a href="#" class="nav-item" data-page="codes">
          <i class="fas fa-code"></i>
          <span>Code Snippets</span>
        </a>
        <a href="#" class="nav-item" data-page="contacts">
          <i class="fas fa-address-book"></i>
          <span>Contacts</span>
        </a>
        <a href="#" class="nav-item" data-page="settings">
          <i class="fas fa-cog"></i>
          <span>Settings</span>
        </a>
      </nav>
    </aside>
    <main class="main-content">
      <header class="top-bar">
        <div class="search-container">
          <input type="text" class="search-input" id="searchInput" placeholder="Search for files, notes, projects...">
          <button class="search-button">
            <i class="fas fa-search"></i>
          </button>
          <div class="search-results" id="searchResults"></div>
        </div>
        <div class="top-bar-actions">
          <button class="icon-button" id="themeToggle">
            <i class="fas fa-moon"></i>
          </button>
          <div class="user-profile-dropdown">
            <button class="user-profile-btn" id="userProfileBtn">
              <img id="topBarProfileImg" style="display:none;" alt="Profile" />
              <i id="topBarProfileIcon" class="fas fa-user-circle"></i>
            </button>
            <div class="user-profile-menu" id="userProfileMenu">
              <div class="user-profile-menu-item">
                <i class="fas fa-user"></i>
                <span id="menuProfileName">Guest</span>
              </div>
              <div class="user-profile-menu-item" id="menuChangeProfileBtn">
                <i class="fas fa-image"></i>
                <span>Change Profile</span>
              </div>
              <div class="user-profile-menu-item" id="menuLoginBtn">
                <i class="fas fa-sign-in-alt"></i>
                <span>Login</span>
              </div>
              <div class="user-profile-menu-item danger" id="menuLogoutBtn" style="display:none;">
                <i class="fas fa-sign-out-alt"></i>
                <span>Logout</span>
              </div>
            </div>
          </div>
        </div>
      </header>
      <div class="content-area" id="contentArea">
        <div id="dashboardPage" class="page-content active">
          <div class="page-header fade-in">
            <h1 class="page-title">Dashboard</h1>
            <p class="page-subtitle">welcome to personal own website</p>
          </div>
          <div class="stats-grid fade-in-up">
            <div class="stat-card">
              <div class="stat-details-row" onclick="navigateToPage('files')">
                <div class="stat-icon primary">
                  <i class="fas fa-folder"></i>
                </div>
                <div class="stat-details">
                  <h3 id="filesCount">0</h3>
                  <p>Files</p>
                </div>
              </div>
              <div class="stat-actions">
                <button class="btn btn-primary btn-sm" onclick="navigateToPage('files')">
                  <i class="fas fa-eye"></i> View All
                </button>
                <button class="btn btn-secondary btn-sm" onclick="triggerImport('files')">
                  <i class="fas fa-file-import"></i> Import
                </button>
              </div>
            </div>
            <div class="stat-card">
              <div class="stat-details-row" onclick="navigateToPage('notes')">
                <div class="stat-icon secondary">
                  <i class="fas fa-sticky-note"></i>
                </div>
                <div class="stat-details">
                  <h3 id="notesCount">0</h3>
                  <p>Notes</p>
                </div>
              </div>
              <div class="stat-actions">
                <button class="btn btn-primary btn-sm" onclick="navigateToPage('notes')">
                  <i class="fas fa-eye"></i> View All
                </button>
                <button class="btn btn-secondary btn-sm" onclick="triggerImport('notes')">
                  <i class="fas fa-file-import"></i> Import
                </button>
              </div>
            </div>
            <div class="stat-card">
              <div class="stat-details-row" onclick="navigateToPage('projects')">
                <div class="stat-icon danger">
                  <i class="fas fa-project-diagram"></i>
                </div>
                <div class="stat-details">
                  <h3 id="projectsCount">0</h3>
                  <p>Projects</p>
                </div>
              </div>
              <div class="stat-actions">
                <button class="btn btn-primary btn-sm" onclick="navigateToPage('projects')">
                  <i class="fas fa-eye"></i> View All
                </button>
                <button class="btn btn-secondary btn-sm" onclick="triggerImport('projects')">
                  <i class="fas fa-file-import"></i> Import
                </button>
              </div>
            </div>
            <div class="stat-card">
              <div class="stat-details-row" onclick="navigateToPage('codes')">
                <div class="stat-icon primary">
                  <i class="fas fa-code"></i>
                </div>
                <div class="stat-details">
                  <h3 id="codesCount">0</h3>
                  <p>Code Snippets</p>
                </div>
              </div>
              <div class="stat-actions">
                <button class="btn btn-primary btn-sm" onclick="navigateToPage('codes')">
                  <i class="fas fa-eye"></i> View All
                </button>
                <button class="btn btn-secondary btn-sm" onclick="triggerImport('codes')">
                  <i class="fas fa-file-import"></i> Import
                </button>
              </div>
            </div>
            <div class="stat-card">
              <div class="stat-details-row" onclick="navigateToPage('contacts')">
                <div class="stat-icon accent">
                  <i class="fas fa-address-book"></i>
                </div>
                <div class="stat-details">
                  <h3 id="contactsCount">0</h3>
                  <p>Contacts</p>
                </div>
              </div>
              <div class="stat-actions">
                <button class="btn btn-primary btn-sm" onclick="navigateToPage('contacts')">
                  <i class="fas fa-eye"></i> View All
                </button>
                <button class="btn btn-secondary btn-sm" onclick="triggerImport('contacts')">
                  <i class="fas fa-file-import"></i> Import
                </button>
              </div>
            </div>
          </div>
          <div class="card fade-in-up">
            <div class="card-header">
              <h2 class="card-title">Recent Activity</h2>
              <div style="display: flex; gap: 10px;">
                <button class="btn btn-danger btn-sm" id="clearActivityBtn">
                  <i class="fas fa-trash"></i> Clear All
                </button>
              </div>
            </div>
            <div id="recentActivity" class="activity-list">
              <div class="empty-state">
                <i class="fas fa-history"></i>
                <h3>No recent activity</h3>
                <p>Your recent actions will appear here</p>
              </div>
            </div>
          </div>
        </div>
        <div id="filesPage" class="page-content">
          <div class="page-header fade-in">
            <h1 class="page-title">Files</h1>
            <p class="page-subtitle">Manage your documents and media files</p>
          </div>
          <div class="card fade-in-up">
            <div class="card-header">
              <h2 class="card-title">Upload Files</h2>
            </div>
            <div class="file-upload-area" id="fileUploadArea">
              <i class="fas fa-cloud-upload-alt"></i>
              <h3>Drag & Drop Files</h3>
              <p>or click to browse</p>
              <input type="file" id="fileInput" multiple style="display: none;">
            </div>
          </div>
          <div class="card fade-in-up">
            <div class="card-header">
              <h2 class="card-title">My Files</h2>
              <div class="view-toggle">
                <button class="view-btn active" id="listViewBtn" title="List View">
                  <i class="fas fa-list"></i>
                </button>
                <button class="view-btn" id="gridViewBtn" title="Grid View">
                  <i class="fas fa-th-large"></i>
                </button>
                <div class="select-dropdown-container">
                  <button class="btn btn-primary" id="selectFilesBtn">
                    Select <i class="fas fa-caret-down"></i>
                  </button>
                  <div class="select-dropdown-menu" id="selectFilesMenu">
                    <a href="#" class="select-dropdown-item" data-action="toggle">Toggle Selection Mode</a>
                    <a href="#" class="select-dropdown-item" data-action="all">Select All</a>
                    <a href="#" class="select-dropdown-item" data-action="none">Deselect All</a>
                    <a href="#" class="select-dropdown-item danger" data-action="delete">Delete Selected</a>
                  </div>
                </div>
              </div>
            </div>
            <div id="filesList" class="file-list">
              <div class="empty-state">
                <i class="fas fa-folder-open"></i>
                <h3>No files yet</h3>
                <p>Upload your first file to get started</p>
              </div>
            </div>
          </div>
        </div>
        <div id="notesPage" class="page-content">
          <div class="page-header fade-in">
            <h1 class="page-title">Notes</h1>
            <p class="page-subtitle">Create and manage your personal notes</p>
          </div>
          <div class="card fade-in-up">
            <div class="card-header">
              <h2 class="card-title">Create New Note</h2>
              <button class="btn btn-secondary" onclick="triggerImport('notes')">
                <i class="fas fa-file-import"></i> Import Notes
              </button>
            </div>
            <div class="form-group">
              <input type="text" class="form-input" id="noteTitle" placeholder="Note Title">
            </div>
            <div class="form-group">
              <textarea class="form-input form-textarea" id="noteContent" placeholder="Write your note here..."></textarea>
            </div>
            <div style="display: flex; gap: 10px;">
              <button class="btn btn-primary" id="saveNoteBtn">
                <i class="fas fa-save"></i> Save Note
              </button>
              <button class="btn btn-outline" id="clearNoteBtn">
                <i class="fas fa-eraser"></i> Clear
              </button>
            </div>
          </div>
          <div class="card fade-in-up">
            <div class="card-header">
              <h2 class="card-title">My Notes</h2>
              <div class="view-toggle">
                <button class="view-btn active" id="notesListViewBtn" title="List View">
                  <i class="fas fa-list"></i>
                </button>
                <button class="view-btn" id="notesGridViewBtn" title="Grid View">
                  <i class="fas fa-th-large"></i>
                </button>
                <div class="select-dropdown-container">
                  <button class="btn btn-primary" id="selectNotesBtn">
                    Select <i class="fas fa-caret-down"></i>
                  </button>
                  <div class="select-dropdown-menu" id="selectNotesMenu">
                    <a href="#" class="select-dropdown-item" data-action="toggle">Toggle Selection Mode</a>
                    <a href="#" class="select-dropdown-item" data-action="all">Select All</a>
                    <a href="#" class="select-dropdown-item" data-action="none">Deselect All</a>
                    <a href="#" class="select-dropdown-item danger" data-action="delete">Delete Selected</a>
                  </div>
                </div>
              </div>
            </div>
            <div id="notesList" class="file-list">
              <div class="empty-state">
                <i class="fas fa-sticky-note"></i>
                <h3>No notes yet</h3>
                <p>Create your first note to get started</p>
              </div>
            </div>
          </div>
        </div>
        <div id="projectsPage" class="page-content">
          <div class="page-header fade-in">
            <h1 class="page-title">Projects</h1>
            <p class="page-subtitle">Manage your development projects</p>
          </div>
          <div class="card fade-in-up">
            <div class="card-header">
              <h2 class="card-title">Create New Project</h2>
              <button class="btn btn-secondary" onclick="triggerImport('projects')">
                <i class="fas fa-file-import"></i> Import Projects
              </button>
            </div>
            <div class="form-group">
              <input type="text" class="form-input" id="projectName" placeholder="Project Name">
            </div>
            <div class="form-group">
              <textarea class="form-input form-textarea" id="projectDescription" placeholder="Project Description"></textarea>
            </div>
            <button class="btn btn-primary" id="createProjectBtn">
              <i class="fas fa-plus"></i> Create Project
            </button>
          </div>
          <div class="card fade-in-up">
            <div class="card-header">
              <h2 class="card-title">My Projects</h2>
              <div class="view-toggle">
                <button class="view-btn active" id="projectsListViewBtn" title="List View">
                  <i class="fas fa-list"></i>
                </button>
                <button class="view-btn" id="projectsGridViewBtn" title="Grid View">
                  <i class="fas fa-th-large"></i>
                </button>
                <div class="select-dropdown-container">
                  <button class="btn btn-primary" id="selectProjectsBtn">
                    Select <i class="fas fa-caret-down"></i>
                  </button>
                  <div class="select-dropdown-menu" id="selectProjectsMenu">
                    <a href="#" class="select-dropdown-item" data-action="toggle">Toggle Selection Mode</a>
                    <a href="#" class="select-dropdown-item" data-action="all">Select All</a>
                    <a href="#" class="select-dropdown-item" data-action="none">Deselect All</a>
                    <a href="#" class="select-dropdown-item danger" data-action="delete">Delete Selected</a>
                  </div>
                </div>
              </div>
            </div>
            <div id="projectsList" class="file-list">
              <div class="empty-state">
                <i class="fas fa-project-diagram"></i>
                <h3>No projects yet</h3>
                <p>Create your first project to get started</p>
              </div>
            </div>
          </div>
        </div>
        <div id="codesPage" class="page-content">
          <div class="page-header fade-in">
            <h1 class="page-title">Code Snippets</h1>
            <p class="page-subtitle">Store and manage your code snippets</p>
          </div>
          <div class="tabs fade-in">
            <div class="tab active" data-tab="python">Python</div>
            <div class="tab" data-tab="javascript">JavaScript</div>
            <div class="tab" data-tab="html">HTML</div>
            <div class="tab" data-tab="css">CSS</div>
            <div class="tab" data-tab="other">Other</div>
          </div>
          <div class="tab-content active" id="python-tab">
            <div class="card fade-in-up">
              <div class="card-header">
                <h2 class="card-title">Add Python Code</h2>
                <button class="btn btn-secondary" onclick="triggerImport('pythonCodes')">
                  <i class="fas fa-file-import"></i> Import
                </button>
              </div>
              <div class="form-group">
                <input type="text" class="form-input" id="pythonCodeTitle" placeholder="Code Title">
              </div>
              <div class="form-group">
                <textarea class="form-input form-textarea" id="pythonCodeContent" placeholder="# Write your Python code here..." style="font-family: monospace;"></textarea>
              </div>
              <div style="display: flex; gap: 10px;">
                <button class="btn btn-primary" id="savePythonCodeBtn">
                  <i class="fas fa-save"></i> Save Code
                </button>
                <button class="btn btn-outline" id="clearPythonCodeBtn">
                  <i class="fas fa-eraser"></i> Clear
                </button>
              </div>
            </div>
            <div class="card fade-in-up">
              <div class="card-header">
                <h2 class="card-title">My Python Codes</h2>
                <div class="view-toggle">
                  <button class="view-btn active" id="pythonListViewBtn" title="List View">
                    <i class="fas fa-list"></i>
                  </button>
                  <button class="view-btn" id="pythonGridViewBtn" title="Grid View">
                    <i class="fas fa-th-large"></i>
                  </button>
                  <div class="select-dropdown-container">
                    <button class="btn btn-primary" id="selectPythonBtn">
                      Select <i class="fas fa-caret-down"></i>
                    </button>
                    <div class="select-dropdown-menu" id="selectPythonMenu">
                      <a href="#" class="select-dropdown-item" data-action="toggle">Toggle Selection Mode</a>
                      <a href="#" class="select-dropdown-item" data-action="all">Select All</a>
                      <a href="#" class="select-dropdown-item" data-action="none">Deselect All</a>
                      <a href="#" class="select-dropdown-item danger" data-action="delete">Delete Selected</a>
                    </div>
                  </div>
                </div>
              </div>
              <div id="pythonCodesList" class="file-list">
                <div class="empty-state">
                  <i class="fas fa-code"></i>
                  <h3>No Python codes yet</h3>
                  <p>Add your first Python code snippet to get started</p>
                </div>
              </div>
            </div>
          </div>
          <div class="tab-content" id="javascript-tab">
            <div class="card fade-in-up">
              <div class="card-header">
                <h2 class="card-title">Add JavaScript Code</h2>
                <button class="btn btn-secondary" onclick="triggerImport('javascriptCodes')">
                  <i class="fas fa-file-import"></i> Import
                </button>
              </div>
              <div class="form-group">
                <input type="text" class="form-input" id="jsCodeTitle" placeholder="Code Title">
              </div>
              <div class="form-group">
                <textarea class="form-input form-textarea" id="jsCodeContent" placeholder="// Write your JavaScript code here..." style="font-family: monospace;"></textarea>
              </div>
              <div style="display: flex; gap: 10px;">
                <button class="btn btn-primary" id="saveJsCodeBtn">
                  <i class="fas fa-save"></i> Save Code
                </button>
                <button class="btn btn-outline" id="clearJsCodeBtn">
                  <i class="fas fa-eraser"></i> Clear
                </button>
              </div>
            </div>
            <div class="card fade-in-up">
              <div class="card-header">
                <h2 class="card-title">My JavaScript Codes</h2>
                <div class="view-toggle">
                  <button class="view-btn active" id="jsListViewBtn" title="List View">
                    <i class="fas fa-list"></i>
                  </button>
                  <button class="view-btn" id="jsGridViewBtn" title="Grid View">
                    <i class="fas fa-th-large"></i>
                  </button>
                  <div class="select-dropdown-container">
                    <button class="btn btn-primary" id="selectJsBtn">
                      Select <i class="fas fa-caret-down"></i>
                    </button>
                    <div class="select-dropdown-menu" id="selectJsMenu">
                      <a href="#" class="select-dropdown-item" data-action="toggle">Toggle Selection Mode</a>
                      <a href="#" class="select-dropdown-item" data-action="all">Select All</a>
                      <a href="#" class="select-dropdown-item" data-action="none">Deselect All</a>
                      <a href="#" class="select-dropdown-item danger" data-action="delete">Delete Selected</a>
                    </div>
                  </div>
                </div>
              </div>
              <div id="javascriptCodesList" class="file-list">
                <div class="empty-state">
                  <i class="fas fa-code"></i>
                  <h3>No JavaScript codes yet</h3>
                  <p>Add your first JavaScript code snippet to get started</p>
                </div>
              </div>
            </div>
          </div>
          <div class="tab-content" id="html-tab">
            <div class="card fade-in-up">
              <div class="card-header">
                <h2 class="card-title">Add HTML Code</h2>
                <button class="btn btn-secondary" onclick="triggerImport('htmlCodes')">
                  <i class="fas fa-file-import"></i> Import
                </button>
              </div>
              <div class="form-group">
                <input type="text" class="form-input" id="htmlCodeTitle" placeholder="Code Title">
              </div>
              <div class="form-group">
                <textarea class="form-input form-textarea" id="htmlCodeContent" placeholder="<!-- Write your HTML code here... -->" style="font-family: monospace;"></textarea>
              </div>
              <div style="display: flex; gap: 10px;">
                <button class="btn btn-primary" id="saveHtmlCodeBtn">
                  <i class="fas fa-save"></i> Save Code
                </button>
                <button class="btn btn-outline" id="clearHtmlCodeBtn">
                  <i class="fas fa-eraser"></i> Clear
                </button>
              </div>
            </div>
            <div class="card fade-in-up">
              <div class="card-header">
                <h2 class="card-title">My HTML Codes</h2>
                <div class="view-toggle">
                  <button class="view-btn active" id="htmlListViewBtn" title="List View">
                    <i class="fas fa-list"></i>
                  </button>
                  <button class="view-btn" id="htmlGridViewBtn" title="Grid View">
                    <i class="fas fa-th-large"></i>
                  </button>
                  <div class="select-dropdown-container">
                    <button class="btn btn-primary" id="selectHtmlBtn">
                      Select <i class="fas fa-caret-down"></i>
                    </button>
                    <div class="select-dropdown-menu" id="selectHtmlMenu">
                      <a href="#" class="select-dropdown-item" data-action="toggle">Toggle Selection Mode</a>
                      <a href="#" class="select-dropdown-item" data-action="all">Select All</a>
                      <a href="#" class="select-dropdown-item" data-action="none">Deselect All</a>
                      <a href="#" class="select-dropdown-item danger" data-action="delete">Delete Selected</a>
                    </div>
                  </div>
                </div>
              </div>
              <div id="htmlCodesList" class="file-list">
                <div class="empty-state">
                  <i class="fas fa-code"></i>
                  <h3>No HTML codes yet</h3>
                  <p>Add your first HTML code snippet to get started</p>
                </div>
              </div>
            </div>
          </div>
          <div class="tab-content" id="css-tab">
            <div class="card fade-in-up">
              <div class="card-header">
                <h2 class="card-title">Add CSS Code</h2>
                <button class="btn btn-secondary" onclick="triggerImport('cssCodes')">
                  <i class="fas fa-file-import"></i> Import
                </button>
              </div>
              <div class="form-group">
                <input type="text" class="form-input" id="cssCodeTitle" placeholder="Code Title">
              </div>
              <div class="form-group">
                <textarea class="form-input form-textarea" id="cssCodeContent" placeholder="/* Write your CSS code here... */" style="font-family: monospace;"></textarea>
              </div>
              <div style="display: flex; gap: 10px;">
                <button class="btn btn-primary" id="saveCssCodeBtn">
                  <i class="fas fa-save"></i> Save Code
                </button>
                <button class="btn btn-outline" id="clearCssCodeBtn">
                  <i class="fas fa-eraser"></i> Clear
                </button>
              </div>
            </div>
            <div class="card fade-in-up">
              <div class="card-header">
                <h2 class="card-title">My CSS Codes</h2>
                <div class="view-toggle">
                  <button class="view-btn active" id="cssListViewBtn" title="List View">
                    <i class="fas fa-list"></i>
                  </button>
                  <button class="view-btn" id="cssGridViewBtn" title="Grid View">
                    <i class="fas fa-th-large"></i>
                  </button>
                  <div class="select-dropdown-container">
                    <button class="btn btn-primary" id="selectCssBtn">
                      Select <i class="fas fa-caret-down"></i>
                    </button>
                    <div class="select-dropdown-menu" id="selectCssMenu">
                      <a href="#" class="select-dropdown-item" data-action="toggle">Toggle Selection Mode</a>
                      <a href="#" class="select-dropdown-item" data-action="all">Select All</a>
                      <a href="#" class="select-dropdown-item" data-action="none">Deselect All</a>
                      <a href="#" class="select-dropdown-item danger" data-action="delete">Delete Selected</a>
                    </div>
                  </div>
                </div>
              </div>
              <div id="cssCodesList" class="file-list">
                <div class="empty-state">
                  <i class="fas fa-code"></i>
                  <h3>No CSS codes yet</h3>
                  <p>Add your first CSS code snippet to get started</p>
                </div>
              </div>
            </div>
          </div>
          <div class="tab-content" id="other-tab">
            <div class="card fade-in-up">
              <div class="card-header">
                <h2 class="card-title">Add Other Code</h2>
                <button class="btn btn-secondary" onclick="triggerImport('otherCodes')">
                  <i class="fas fa-file-import"></i> Import
                </button>
              </div>
              <div class="form-group">
                <input type="text" class="form-input" id="otherCodeTitle" placeholder="Code Title">
              </div>
              <div class="form-group">
                <textarea class="form-input form-textarea" id="otherCodeContent" placeholder="Write your general code or script here..." style="font-family: monospace;"></textarea>
              </div>
              <div style="display: flex; gap: 10px;">
                <button class="btn btn-primary" id="saveOtherCodeBtn">
                  <i class="fas fa-save"></i> Save Code
                </button>
                <button class="btn btn-outline" id="clearOtherCodeBtn">
                  <i class="fas fa-eraser"></i> Clear
                </button>
              </div>
            </div>
            <div class="card fade-in-up">
              <div class="card-header">
                <h2 class="card-title">My Other Codes</h2>
                <div class="view-toggle">
                  <button class="view-btn active" id="otherListViewBtn" title="List View">
                    <i class="fas fa-list"></i>
                  </button>
                  <button class="view-btn" id="otherGridViewBtn" title="Grid View">
                    <i class="fas fa-th-large"></i>
                  </button>
                  <div class="select-dropdown-container">
                    <button class="btn btn-primary" id="selectOtherBtn">
                      Select <i class="fas fa-caret-down"></i>
                    </button>
                    <div class="select-dropdown-menu" id="selectOtherMenu">
                      <a href="#" class="select-dropdown-item" data-action="toggle">Toggle Selection Mode</a>
                      <a href="#" class="select-dropdown-item" data-action="all">Select All</a>
                      <a href="#" class="select-dropdown-item" data-action="none">Deselect All</a>
                      <a href="#" class="select-dropdown-item danger" data-action="delete">Delete Selected</a>
                    </div>
                  </div>
                </div>
              </div>
              <div id="otherCodesList" class="file-list">
                <div class="empty-state">
                  <i class="fas fa-code"></i>
                  <h3>No Other codes yet</h3>
                  <p>Add your first general code snippet to get started</p>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div id="contactsPage" class="page-content">
          <div class="page-header fade-in">
            <h1 class="page-title">Contacts</h1>
            <p class="page-subtitle">Manage your professional and personal contacts</p>
          </div>
          <div class="card fade-in-up">
            <div class="card-header">
              <h2 class="card-title">Add New Contact</h2>
              <button class="btn btn-secondary" onclick="triggerImport('contacts')">
                <i class="fas fa-file-import"></i> Import Contacts
              </button>
            </div>
            <div class="form-group">
              <input type="text" class="form-input" id="contactName" placeholder="Full Name" required>
            </div>
            <div class="form-group">
              <input type="email" class="form-input" id="contactEmail" placeholder="Email Address (Optional)">
            </div>
            <div class="form-group">
              <input type="tel" class="form-input" id="contactPhone" placeholder="Phone Number (Optional)">
            </div>
            <div class="form-group">
              <textarea class="form-input form-textarea" id="contactNotes" placeholder="Additional Notes (e.g., Company, Role)"></textarea>
            </div>
            <div style="display: flex; gap: 10px;">
              <button class="btn btn-primary" id="saveContactBtn">
                <i class="fas fa-user-plus"></i> Save Contact
              </button>
              <button class="btn btn-outline" id="clearContactBtn">
                <i class="fas fa-eraser"></i> Clear
              </button>
            </div>
          </div>
          <div class="card fade-in-up">
            <div class="card-header">
              <h2 class="card-title">My Contacts</h2>
              <div class="view-toggle">
                <button class="view-btn active" id="contactsListViewBtn" title="List View">
                  <i class="fas fa-list"></i>
                </button>
                <button class="view-btn" id="contactsGridViewBtn" title="Grid View">
                  <i class="fas fa-th-large"></i>
                </button>
                <div class="select-dropdown-container">
                  <button class="btn btn-primary" id="selectContactsBtn">
                    Select <i class="fas fa-caret-down"></i>
                  </button>
                  <div class="select-dropdown-menu" id="selectContactsMenu">
                    <a href="#" class="select-dropdown-item" data-action="toggle">Toggle Selection Mode</a>
                    <a href="#" class="select-dropdown-item" data-action="all">Select All</a>
                    <a href="#" class="select-dropdown-item" data-action="none">Deselect All</a>
                    <a href="#" class="select-dropdown-item danger" data-action="delete">Delete Selected</a>
                  </div>
                </div>
              </div>
            </div>
            <div id="contactsList" class="file-list">
              <div class="empty-state">
                <i class="fas fa-address-book"></i>
                <h3>No contacts yet</h3>
                <p>Add your first contact to get started</p>
              </div>
            </div>
          </div>
        </div>
        <div id="settingsPage" class="page-content">
          <div class="page-header fade-in">
            <h1 class="page-title">Settings</h1>
            <p class="page-subtitle">Personalize and manage your application preferences</p>
          </div>
          <div class="card fade-in-up">
            <div class="settings-section">
              <h2 class="settings-title"><i class="fas fa-palette"></i> Appearance</h2>
              <div class="settings-item">
                <span>Dark Mode</span>
                <label class="switch">
                  <input type="checkbox" id="darkModeSwitch">
                  <span class="slider"></span>
                </label>
              </div>
              <div class="settings-item">
                <span>Reduce Animations</span>
                <label class="switch">
                  <input type="checkbox" id="animationsToggle">
                  <span class="slider"></span>
                </label>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>
  <script>
    // Password eye toggle
    (function () {
      const passwordInput = document.getElementById('loginPassword');
      const toggleBtn = document.getElementById('passwordToggle');

      if (!passwordInput || !toggleBtn) return;

      toggleBtn.addEventListener('click', () => {
        const isPassword = passwordInput.type === 'password';
        passwordInput.type = isPassword ? 'text' : 'password';
        toggleBtn.classList.toggle('active', !isPassword);
        const icon = toggleBtn.querySelector('i');
        if (icon) {
          icon.className = isPassword ? 'fas fa-eye-slash' : 'fas fa-eye';
        }
      });
    })();

    // --- API CONFIGURATION ---
    const API_BASE = (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1')
      ? 'http://localhost:3000/api'
      : '/api';
    // --- HELPER: Generate UUID ---
    function generateId() {
      return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
        const r = Math.random() * 16 | 0;
        const v = c == 'x' ? r : (r & 0x3 | 0x8);
        return v.toString(16);
      });
    }
    // --- API CALL WRAPPERS ---
    async function apiCall(endpoint, options = {}) {
      const url = API_BASE + endpoint;
      const config = {
        headers: {
          'Content-Type': 'application/json',
          ...(options.headers || {})
        },
        ...options
      };
      try {
        const response = await fetch(url, config);
        if (!response.ok) {
          let errorDetail = await response.text();
          try {
            const errorJson = JSON.parse(errorDetail);
            errorDetail = errorJson.message || errorDetail;
          } catch (e) {
            // ignore if not json
          }
          throw new Error(`HTTP error! status: ${response.status}. Detail: ${errorDetail}`);
        }
        if (response.status === 204) {
          return {};
        }
        return await response.json();
      } catch (error) {
        console.error('API Error:', error);
        showToast(`API Error: ${error.message}`, 'error');
        throw error;
      }
    }
    async function loadDataFromAPI(type) {
      const endpointMap = {
        files: '/files',
        notes: '/notes',
        projects: '/projects',
        contacts: '/contacts',
        pythonCodes: '/codes/python',
        javascriptCodes: '/codes/javascript',
        htmlCodes: '/codes/html',
        cssCodes: '/codes/css',
        otherCodes: '/codes/other'
      };
      const endpoint = endpointMap[type];
      if (!endpoint) {
        console.warn('Unknown type for API load:', type);
        return [];
      }
      try {
        const data = await apiCall(endpoint, { method: 'GET' });
        return Array.isArray(data) ? data : [];
      } catch (error) {
        showToast(`Failed to load ${type}`, 'error');
        return [];
      }
    }
    async function saveItemToAPI(type, item, method = 'POST', id = null) {
      const endpointMap = {
        files: '/files',
        notes: '/notes',
        projects: '/projects',
        contacts: '/contacts',
        pythonCodes: '/codes/python',
        javascriptCodes: '/codes/javascript',
        htmlCodes: '/codes/html',
        cssCodes: '/codes/css',
        otherCodes: '/codes/other'
      };
      const endpoint = endpointMap[type];
      if (!endpoint) {
        throw new Error('Unknown type for API save');
      }
      const url = method === 'PUT' && id ? `${endpoint}/${id}` : endpoint;
      const payload = { ...item };
      if (!payload.id && method === 'POST') payload.id = generateId();
      const payloadToSend = { ...payload };
      if (method === 'PUT') delete payloadToSend.id;
      try {
        const result = await apiCall(url, {
          method: method,
          body: JSON.stringify(payloadToSend)
        });
        return { ...payload, ...result };
      } catch (error) {
        showToast(`Failed to save ${type}`, 'error');
        throw error;
      }
    }
    async function deleteItemFromAPI(type, id) {
      const endpointMap = {
        files: '/files',
        notes: '/notes',
        projects: '/projects',
        contacts: '/contacts',
        pythonCodes: '/codes/python',
        javascriptCodes: '/codes/javascript',
        htmlCodes: '/codes/html',
        cssCodes: '/codes/css',
        otherCodes: '/codes/other'
      };
      const endpoint = endpointMap[type];
      if (!endpoint) throw new Error('Unknown type for API delete');
      try {
        await apiCall(`${endpoint}/${id}`, { method: 'DELETE', headers: {} });
        return true;
      } catch (error) {
        showToast(`Failed to delete ${type}`, 'error');
        throw error;
      }
    }
    // --- DATA STATE ---
    let filesData = [];
    let notesData = [];
    let projectsData = [];
    let contactsData = [];
    let pythonCodesData = [];
    let jsCodesData = [];
    let htmlCodesData = [];
    let cssCodesData = [];
    let otherCodesData = [];
    // --- GLOBAL STATE ---
    let isAuthenticated = false;
    let currentImportType = null;
    let selectionMode = {
      files: false,
      notes: false,
      projects: false,
      contacts: false,
      pythonCodes: false,
      javascriptCodes: false,
      htmlCodes: false,
      cssCodes: false,
      otherCodes: false
    };
    // --- RECENT ACTIVITY ---
    async function logActivity(action, itemType, itemName) {
      const activity = {
        action,
        itemType,
        itemName
      };
      try {
        await apiCall('/activity', {
          method: 'POST',
          body: JSON.stringify(activity)
        });
        renderRecentActivity(); 
      } catch (error) {
        console.error("Failed to log activity", error);
      }
    }
    async function renderRecentActivity() {
      const container = document.getElementById('recentActivity');
      try {
        const recentActivities = await apiCall('/activity', { method: 'GET' });
        if (!recentActivities || recentActivities.length === 0) {
          container.innerHTML = `
            <div class="empty-state">
              <i class="fas fa-history"></i>
              <h3>No recent activity</h3>
              <p>Your recent actions will appear here</p>
            </div>
          `;
          return;
        }
        container.innerHTML = '';
        recentActivities.forEach(act => {
          const iconMap = {
            file: 'fas fa-file',
            note: 'fas fa-sticky-note',
            project: 'fas fa-project-diagram',
            pythonCodes: 'fab fa-python',
            javascriptCodes: 'fab fa-js',
            htmlCodes: 'fab fa-html5',
            cssCodes: 'fab fa-css3-alt',
            otherCodes: 'fas fa-code',
            contact: 'fas fa-user-circle'
          };
          const actionMap = { create: 'created', edit: 'edited', delete: 'deleted' };
          const icon = iconMap[act.itemType] || 'fas fa-question-circle';
          const actionText = actionMap[act.action] || act.action;
          const typeLabel = act.itemType
            .replace(/Codes$/, '')
            .replace(/([A-Z])/g, ' $1')
            .replace(/^./, str => str.toUpperCase());
          const el = document.createElement('div');
          el.className = 'activity-item';
          el.innerHTML = `
            <div style="display: flex; align-items: flex-start; gap: 12px; padding: 12px 0; border-bottom: 1px solid rgba(0,0,0,0.05);">
              <div style="width: 32px; height: 32px; border-radius: 50%; background-color: var(--file-item-background); display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                <i class="${icon}" style="color: var(--primary-color);"></i>
              </div>
              <div style="flex: 1;">
                <p style="margin: 0; font-size: 0.95rem;">
                  <strong>${act.itemName}</strong> was ${actionText}
                  <span style="color: var(--tab-text-color); font-size: 0.85rem;"> â€¢ ${formatDateTime(act.date)}</span>
                </p>
                <p style="margin: 4px 0 0; font-size: 0.85rem; color: var(--tab-text-color);">${typeLabel}</p>
              </div>
            </div>
          `;
          container.appendChild(el);
        });
      } catch (error) {
        console.error("Error fetching activities", error);
      }
    }
    // === CONFIRMATION SYSTEM ===
    let onConfirmCallback = null;
    function showConfirmation(title, message, onConfirm) {
      document.getElementById('confirmationModalTitle').textContent = title;
      document.getElementById('confirmationModalMessage').textContent = message;
      onConfirmCallback = onConfirm;
      confirmationModal.classList.add('active');
    }
    document.getElementById('confirmYesBtn').addEventListener('click', () => {
      if (onConfirmCallback && typeof onConfirmCallback === 'function') {
        onConfirmCallback();
      }
      confirmationModal.classList.remove('active');
      onConfirmCallback = null;
    });
    function clearRecentActivity() {
      showConfirmation(
        'Clear Recent Activity',
        'Are you sure you want to clear all recent activity?',
        async () => {
          await apiCall('/activity', { method: 'DELETE' });
          renderRecentActivity();
          showToast('Recent activity cleared.', 'info');
        }
      );
    }
    // --- DOM ELEMENTS ---
    const sidebar = document.getElementById('sidebar');
    const toggleSidebarBtn = document.getElementById('toggleSidebar');
    const navItems = document.querySelectorAll('.nav-item');
    const body = document.body;
    const fileUploadArea = document.getElementById('fileUploadArea');
    const fileInput = document.getElementById('fileInput');
    const viewContentModal = document.getElementById('viewContentModal');
    const editItemModal = document.getElementById('editItemModal');
    const confirmationModal = document.getElementById('confirmationModal');
    const userProfileBtn = document.getElementById('userProfileBtn');
    const userProfileMenu = document.getElementById('userProfileMenu');
    const menuProfileName = document.getElementById('menuProfileName');
    const menuLoginBtn = document.getElementById('menuLoginBtn');
    const menuLogoutBtn = document.getElementById('menuLogoutBtn');
    const menuChangeProfileBtn = document.getElementById('menuChangeProfileBtn');
    const topBarProfileImg = document.getElementById('topBarProfileImg');
    const topBarProfileIcon = document.getElementById('topBarProfileIcon');
    const searchInput = document.getElementById('searchInput');
    const searchResults = document.getElementById('searchResults');
    let searchTimeout;
    const formatDateTime = (dateString) => {
      return new Date(dateString).toLocaleString();
    };
    function showToast(message, type = 'info') {
      const toast = document.getElementById('toast');
      const toastMessage = document.getElementById('toastMessage');
      const toastIcon = document.getElementById('toastIcon');
      toast.className = 'toast';
      toastIcon.className = '';
      toastMessage.textContent = message;
      switch (type) {
        case 'success':
          toastIcon.className = 'fas fa-check-circle';
          toast.classList.add('success');
          break;
        case 'error':
          toastIcon.className = 'fas fa-exclamation-circle';
          toast.classList.add('error');
          break;
        case 'info':
        default:
          toastIcon.className = 'fas fa-info-circle';
          toast.classList.add('info');
          break;
      }
      toast.classList.add('show');
      const baseTime = 3000;
      const extraTime = Math.min(message.length * 30, 5000);
      const totalTime = baseTime + extraTime;
      setTimeout(() => {
        toast.classList.remove('show');
      }, totalTime);
    }
    function handleDownload(content, filename, mimeType) {
      try {
        const blob = new Blob([content], { type: mimeType });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = filename;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      } catch (error) {
        showToast('Download failed. Please check console for details.', 'error');
        console.error("Download Error:", error);
      }
    }
    function navigateToPage(pageId) {
      document.querySelectorAll('.page-content').forEach(page => {
        page.classList.remove('active');
      });
      document.getElementById(pageId + 'Page').classList.add('active');
      navItems.forEach(item => {
        item.classList.remove('active');
        if (item.getAttribute('data-page') === pageId) {
          item.classList.add('active');
        }
      });
      if (window.innerWidth <= 768) {
        sidebar.classList.remove('active');
      }
      if (pageId === 'dashboard') {
        updateDashboardStats();
      }
    }
    navItems.forEach(item => {
      item.addEventListener('click', (e) => {
        e.preventDefault();
        navigateToPage(item.getAttribute('data-page'));
      });
    });
    toggleSidebarBtn.addEventListener('click', () => {
      if (window.innerWidth > 768) {
        sidebar.classList.toggle('collapsed');
      } else {
        sidebar.classList.toggle('active');
      }
    });
    function updateAuthUI(loggedIn, username = '') {
      isAuthenticated = loggedIn;
      menuProfileName.textContent = username || 'Guest';
      if (loggedIn) {
        menuLoginBtn.style.display = 'none';
        menuLogoutBtn.style.display = 'flex';
      } else {
        menuLoginBtn.style.display = 'flex';
        menuLogoutBtn.style.display = 'none';
      }
    }
    function logoutUser() {
      localStorage.removeItem('profilePicture');
      localStorage.removeItem('isLoggedIn');
      body.classList.remove('logged-in');
      loadProfilePicture();
      updateAuthUI(false, '');
      showToast('Logged out successfully.', 'info');
      navigateToPage('dashboard');
      document.getElementById('loginPortal').classList.add('active');
    }
    // --- NEW LOGIN LOGIC ---
    document.getElementById('loginSubmitBtn')?.addEventListener('click', () => {
      const emailInput = document.getElementById('loginEmail');
      const passwordInput = document.getElementById('loginPassword');
      const email = emailInput.value.trim();
      const password = passwordInput.value.trim();
      // Clear the input fields after attempt
      emailInput.value = '';
      passwordInput.value = '';
      // Hardcoded credentials as requested
      if (email === 'saikambala' && password === 'sai12358') {
        updateAuthUI(true, 'saikambala');
        localStorage.setItem('isLoggedIn', 'true');
        body.classList.add('logged-in');
        showToast('Login successful! Welcome, saikambala.', 'success');
        document.getElementById('loginPortal').classList.remove('active');
        navigateToPage('dashboard'); // Navigate to dashboard after login
      } else {
        showToast('Invalid credentials. Please try again.', 'error');
      }
    });
    menuLoginBtn.addEventListener('click', () => {
      document.getElementById('loginPortal').classList.add('active');
      userProfileMenu.classList.remove('active');
    });
    // === PROFILE PICTURE UPLOAD ===
    const profilePicInput = document.createElement('input');
    profilePicInput.type = 'file';
    profilePicInput.accept = 'image/*';
    profilePicInput.style.display = 'none';
    document.body.appendChild(profilePicInput);
    menuChangeProfileBtn.addEventListener('click', () => {
      userProfileMenu.classList.remove('active');
      profilePicInput.click();
    });
    profilePicInput.addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (!file) return;
      if (!file.type.startsWith('image/')) {
        showToast('Please select an image file (JPEG, PNG, etc.).', 'error');
        return;
      }
      const reader = new FileReader();
      reader.onload = function(event) {
        const imgDataUrl = event.target.result;
        localStorage.setItem('profilePicture', imgDataUrl);
        loadProfilePicture();
        showToast('Profile picture updated!', 'success');
      };
      reader.readAsDataURL(file);
      profilePicInput.value = '';
    });
    function loadProfilePicture() {
        const savedImg = localStorage.getItem('profilePicture');
        if (savedImg) {
            topBarProfileImg.src = savedImg;
            topBarProfileImg.style.display = 'block';
            topBarProfileIcon.style.display = 'none';
        } else {
            topBarProfileImg.src = '';
            topBarProfileImg.style.display = 'none';
            topBarProfileIcon.style.display = 'block';
        }
    }
    userProfileBtn.addEventListener('click', () => {
        userProfileMenu.classList.toggle('active');
    });
    document.addEventListener('click', (e) => {
        if (!userProfileBtn.contains(e.target) && !userProfileMenu.contains(e.target)) {
            userProfileMenu.classList.remove('active');
        }
    });
    function updateDashboardStats() {
      document.getElementById('filesCount').textContent = filesData.length;
      document.getElementById('notesCount').textContent = notesData.length;
      document.getElementById('projectsCount').textContent = projectsData.length;
      document.getElementById('codesCount').textContent = pythonCodesData.length + jsCodesData.length +   htmlCodesData.length + cssCodesData.length + otherCodesData.length;
      document.getElementById('contactsCount').textContent = contactsData.length;
    }    
    function openContentViewer(title, metadataHtml, content, isCode = false) {
        document.getElementById('viewContentModalTitle').textContent = title;
        document.getElementById('viewContentModalMeta').innerHTML = metadataHtml;
        const bodyEl = document.getElementById('viewContentModalBody');
        bodyEl.textContent = content;
        viewContentModal.classList.add('active');
    }
    // --- SEARCH FUNCTIONALITY ---
    function performSearch(query) {
        if (!query || query.trim() === '') {
            searchResults.classList.remove('active');
            return;
        }
        const results = [];
        const lowerQuery = query.toLowerCase();
        const allData = [
          { data: filesData, type: 'file', titleKey: 'title', contentKey: 'title' },
          { data: notesData, type: 'note', titleKey: 'title', contentKey: 'content' },
          { data: projectsData, type: 'project', titleKey: 'name', contentKey: 'description' },
          { data: contactsData, type: 'contact', titleKey: 'name', contentKey: 'name,email,phone,notes' },
          { data: pythonCodesData, type: 'pythonCodes', titleKey: 'title', contentKey: 'content', label: 'Python' },
          { data: jsCodesData, type: 'javascriptCodes', titleKey: 'title', contentKey: 'content', label: 'JavaScript' },
          { data: htmlCodesData, type: 'htmlCodes', titleKey: 'title', contentKey: 'content', label: 'HTML' },
          { data: cssCodesData, type: 'cssCodes', titleKey: 'title', contentKey: 'content', label: 'CSS' },
          { data: otherCodesData, type: 'otherCodes', titleKey: 'title', contentKey: 'content', label: 'Other' }
        ];
        allData.forEach(group => {
          group.data.forEach((item, index) => {
            let match = false;
            if (item[group.titleKey] && item[group.titleKey].toLowerCase().includes(lowerQuery)) {
              match = true;
            } else if (group.contentKey) {
              const keys = group.contentKey.split(',');
              for (const key of keys) {
                if (item[key] && item[key].toString().toLowerCase().includes(lowerQuery)) {
                  match = true;
                  break;
                }
              }
            }
            if (match) {
              const iconMap = {
                file: 'fas fa-file',
                note: 'fas fa-sticky-note',
                project: 'fas fa-project-diagram',
                contact: 'fas fa-user-circle',
                code: 'fas fa-code'
              };
              let icon = 'fas fa-code';
              let subtitle = '';
              if (group.type === 'file') {
                icon = 'fas fa-file';
                if (item.mimetype?.includes('image')) icon = 'fas fa-image';
                else if (item.mimetype?.includes('pdf')) icon = 'fas fa-file-pdf';
                else if (item.mimetype?.includes('text')) icon = 'fas fa-file-alt';
                subtitle = `File â€¢ ${formatDateTime(item.date)}`;
              } else if (group.type === 'note') {
                icon = 'fas fa-sticky-note';
                subtitle = `Note â€¢ ${formatDateTime(item.date)}`;
              } else if (group.type === 'project') {
                icon = 'fas fa-project-diagram';
                subtitle = `Project â€¢ ${formatDateTime(item.date)}`;
              } else if (group.type === 'contact') {
                icon = 'fas fa-user-circle';
                subtitle = `Contact â€¢ ${item.email || 'No email'}`;
              } else {
                icon = 'fas fa-code';
                subtitle = `${group.label} Code â€¢ ${formatDateTime(item.date)}`;
              }
              results.push({
                type: group.type === 'file' || group.type === 'note' || group.type === 'project' || group.type === 'contact' ? group.type : 'code',
                title: item[group.titleKey],
                subtitle,
                icon,
                data: { index, type: group.type, id: item.id }
              });
            }
          });
        });
        displaySearchResults(results);
    }
    function displaySearchResults(results) {
        searchResults.innerHTML = '';
        if (results.length === 0) {
            searchResults.innerHTML = '<div class="search-no-results">No results found</div>';
        } else {
            results.forEach(result => {
                const resultItem = document.createElement('div');
                resultItem.className = 'search-result-item';
                resultItem.innerHTML = `
                    <div class="search-result-icon">
                        <i class="${result.icon}"></i>
                    </div>
                    <div class="search-result-content">
                        <div class="search-result-title">${result.title}</div>
                        <div class="search-result-type">${result.subtitle}</div>
                    </div>
                `;
                resultItem.addEventListener('click', () => {
                    navigateToSearchResult(result.data);
                    searchResults.classList.remove('active');
                    searchInput.value = '';
                });
                searchResults.appendChild(resultItem);
            });
        }
        searchResults.classList.add('active');
    }
    function navigateToSearchResult(data) {
        const { type, index } = data;
        switch (type) {
            case 'file':
                navigateToPage('files');
                setTimeout(() => viewFile(index), 300);
                break;
            case 'note':
                navigateToPage('notes');
                setTimeout(() => viewNote(index), 300);
                break;
            case 'project':
                navigateToPage('projects');
                setTimeout(() => viewProject(index), 300);
                break;
            case 'contact':
                navigateToPage('contacts');
                setTimeout(() => viewContact(index), 300);
                break;
            case 'pythonCodes':
                navigateToPage('codes');
                setTimeout(() => {
                    document.querySelectorAll('#codesPage .tabs .tab').forEach(tab => tab.classList.remove('active'));
                    document.querySelector('#codesPage .tabs .tab[data-tab="python"]').classList.add('active');
                    document.querySelectorAll('#codesPage .tab-content').forEach(content => content.classList.remove('active'));
                    document.getElementById('python-tab').classList.add('active');
                    viewCode('pythonCodes', index);
                }, 300);
                break;
            case 'javascriptCodes':
                navigateToPage('codes');
                setTimeout(() => {
                    document.querySelectorAll('#codesPage .tabs .tab').forEach(tab => tab.classList.remove('active'));
                    document.querySelector('#codesPage .tabs .tab[data-tab="javascript"]').classList.add('active');
                    document.querySelectorAll('#codesPage .tab-content').forEach(content => content.classList.remove('active'));
                    document.getElementById('javascript-tab').classList.add('active');
                    viewCode('javascriptCodes', index);
                }, 300);
                break;
            case 'htmlCodes':
                navigateToPage('codes');
                setTimeout(() => {
                    document.querySelectorAll('#codesPage .tabs .tab').forEach(tab => tab.classList.remove('active'));
                    document.querySelector('#codesPage .tabs .tab[data-tab="html"]').classList.add('active');
                    document.querySelectorAll('#codesPage .tab-content').forEach(content => content.classList.remove('active'));
                    document.getElementById('html-tab').classList.add('active');
                    viewCode('htmlCodes', index);
                }, 300);
                break;
            case 'cssCodes':
                navigateToPage('codes');
                setTimeout(() => {
                    document.querySelectorAll('#codesPage .tabs .tab').forEach(tab => tab.classList.remove('active'));
                    document.querySelector('#codesPage .tabs .tab[data-tab="css"]').classList.add('active');
                    document.querySelectorAll('#codesPage .tab-content').forEach(content => content.classList.remove('active'));
                    document.getElementById('css-tab').classList.add('active');
                    viewCode('cssCodes', index);
                }, 300);
                break;
            case 'otherCodes':
                navigateToPage('codes');
                setTimeout(() => {
                    document.querySelectorAll('#codesPage .tabs .tab').forEach(tab => tab.classList.remove('active'));
                    document.querySelector('#codesPage .tabs .tab[data-tab="other"]').classList.add('active');
                    document.querySelectorAll('#codesPage .tab-content').forEach(content => content.classList.remove('active'));
                    document.getElementById('other-tab').classList.add('active');
                    viewCode('otherCodes', index);
                }, 300);
                break;
        }
    }
    searchInput.addEventListener('input', (e) => {
        clearTimeout(searchTimeout);
        searchTimeout = setTimeout(() => {
            performSearch(e.target.value);
        }, 300);
    });
    document.addEventListener('click', (e) => {
        if (!searchInput.contains(e.target) && !searchResults.contains(e.target)) {
            searchResults.classList.remove('active');
        }
    });
    // ============ IMPORT FUNCTIONALITY ============
    function triggerImport(type) {
      const input = document.createElement('input');
      input.type = 'file';
      input.multiple = true;
      input.style.display = 'none';
      input.onchange = (e) => {
        const files = Array.from(e.target.files);
        if (files.length === 0) return;
        if (type === 'files') {
          processUploadedFiles(files);
        } else if (['notes', 'projects', 'contacts'].includes(type)) {
          importTextFiles(files, type);
        } else if (['pythonCodes', 'javascriptCodes', 'htmlCodes', 'cssCodes', 'otherCodes'].includes(type)) {
          importCodeFiles(files, type);
        } else {
          showToast('Import not supported for this type.', 'error');
        }
        document.body.removeChild(input);
      };
      document.body.appendChild(input);
      input.click();
    }
    function importTextFiles(files, type) {
      files.forEach(file => {
        const reader = new FileReader();
        reader.onload = () => {
          try {
            let content = reader.result;
            let newItem;
            if (file.name.endsWith('.json')) {
              const parsed = JSON.parse(content);
              if (Array.isArray(parsed)) {
                parsed.forEach(item => addItemByType(type, item));
              } else {
                addItemByType(type, parsed);
              }
            } else {
              if (type === 'notes') {
                newItem = {
                  title: file.name.replace(/\.[^/.]+$/, ""),
                  content: content,
                  date: new Date().toISOString()
                };
              } else if (type === 'projects') {
                newItem = {
                  name: file.name.replace(/\.[^/.]+$/, ""),
                  description: content,
                  date: new Date().toISOString()
                };
              } else if (type === 'contacts') {
                newItem = {
                  name: file.name.replace(/\.[^/.]+$/, ""),
                  notes: content,
                  email: '',
                  phone: '',
                  date: new Date().toISOString()
                };
              }
              if (newItem) addItemByType(type, newItem);
            }
            showToast(`Imported: ${file.name}`, 'success');
          } catch (err) {
            showToast(`Failed to import ${file.name}: ${err.message}`, 'error');
            console.error(err);
          }
        };
        reader.readAsText(file);
      });
    }
    function importCodeFiles(files, type) {
      files.forEach(file => {
        const reader = new FileReader();
        reader.onload = () => {
          const newItem = {
            title: file.name.replace(/\.[^/.]+$/, ""),
            content: reader.result,
            date: new Date().toISOString()
          };
          addItemByType(type, newItem);
          showToast(`Code imported: ${file.name}`, 'success');
        };
        reader.readAsText(file);
      });
    }
    async function addItemByType(type, item) {
      try {
        const savedItem = await saveItemToAPI(type, item);
        const id = savedItem.id || savedItem._id || item.id;
        const newItem = { ...item, id };
        switch(type) {
          case 'notes':
            notesData.unshift(newItem);
            renderNotes();
            break;
          case 'projects':
            projectsData.unshift(newItem);
            renderProjects();
            break;
          case 'contacts':
            contactsData.unshift(newItem);
            renderContacts();
            break;
          case 'pythonCodes':
            pythonCodesData.unshift(newItem);
            break;
          case 'javascriptCodes':
            jsCodesData.unshift(newItem);
            break;
          case 'htmlCodes':
            htmlCodesData.unshift(newItem);
            break;
          case 'cssCodes':
            cssCodesData.unshift(newItem);
            break;
          case 'otherCodes':
            otherCodesData.unshift(newItem);
            break;
        }
        if (['pythonCodes', 'javascriptCodes', 'htmlCodes', 'cssCodes', 'otherCodes'].includes(type)) {
          renderCodeSnippets();
        }
        logActivity('create', type, item.title || item.name || 'Imported Item');
        updateDashboardStats();
      } catch (error) {
        console.error('Add item failed:', error);
      }
    }
    // ============ END IMPORT FUNCTIONALITY ============
    // --- UNIVERSAL EDIT FUNCTIONALITY ---
    let currentEditType = null;
    let currentEditItem = null;
    function openEditModal(type, index) {
        currentEditType = type;
        currentEditItem = index;
        let title = '';
        let formHTML = '';
        switch(type) {
            case 'file':
                const file = filesData[index];
                if (!file.mimetype?.includes('text') && !file.mimetype?.includes('json') && !file.mimetype?.includes('xml') &&
                    !file.name?.endsWith('.html') && !file.name?.endsWith('.css') && !file.name?.endsWith('.js') &&
                    !file.name?.endsWith('.py') && !file.name?.endsWith('.txt')) {
                    showToast('Editing is only supported for text-based files.', 'error');
                    return;
                }
                title = `Edit File: ${file.title || file.name}`;
                // NOTE: We assume file.content for text files is stored as Base64 by the API for editing purposes.
                const fileContent = file.content ? atob(file.content) : '';
                formHTML = `
                    <div class="form-group">
                        <label for="editItemName" class="form-label">File Title</label>
                        <input type="text" class="form-input" id="editItemName" value="${file.title || file.name}" required>
                    </div>
                    <div class="form-group">
                        <label for="editItemContent" class="form-label">File Content</label>
                        <textarea class="form-input form-textarea" id="editItemContent" style="font-family: monospace;">${fileContent}</textarea>
                    </div>
                `;
                break;
            case 'note':
                const note = notesData[index];
                title = `Edit Note: ${note.title}`;
                formHTML = `
                    <div class="form-group">
                        <label for="editItemName" class="form-label">Note Title</label>
                        <input type="text" class="form-input" id="editItemName" value="${note.title}" required>
                    </div>
                    <div class="form-group">
                        <label for="editItemContent" class="form-label">Note Content</label>
                        <textarea class="form-input form-textarea" id="editItemContent">${note.content}</textarea>
                    </div>
                `;
                break;
            case 'project':
                const project = projectsData[index];
                title = `Edit Project: ${project.name}`;
                formHTML = `
                    <div class="form-group">
                        <label for="editItemName" class="form-label">Project Name</label>
                        <input type="text" class="form-input" id="editItemName" value="${project.name}" required>
                    </div>
                    <div class="form-group">
                        <label for="editItemContent" class="form-label">Project Description</label>
                        <textarea class="form-input form-textarea" id="editItemContent">${project.description}</textarea>
                    </div>
                `;
                break;
            case 'contact':
                const contact = contactsData[index];
                title = `Edit Contact: ${contact.name}`;
                formHTML = `
                    <div class="form-group">
                        <label for="editItemName" class="form-label">Full Name</label>
                        <input type="text" class="form-input" id="editItemName" value="${contact.name}" required>
                    </div>
                    <div class="form-group">
                        <label for="editItemEmail" class="form-label">Email Address</label>
                        <input type="email" class="form-input" id="editItemEmail" value="${contact.email || ''}">
                    </div>
                    <div class="form-group">
                        <label for="editItemPhone" class="form-label">Phone Number</label>
                        <input type="tel" class="form-input" id="editItemPhone" value="${contact.phone || ''}">
                    </div>
                    <div class="form-group">
                        <label for="editItemNotes" class="form-label">Additional Notes</label>
                        <textarea class="form-input form-textarea" id="editItemNotes">${contact.notes || ''}</textarea>
                    </div>
                `;
                break;
            case 'code':
                const languageCodeType = getLanguageCodeType(index);
                const codeData = getCodeData(languageCodeType.type)[languageCodeType.indexInType];
                const languageLabel = languageCodeType.type.replace('Codes', '').charAt(0).toUpperCase() + languageCodeType.type.replace('Codes', '').slice(1);
                title = `Edit ${languageLabel} Code: ${codeData.title}`;
                formHTML = `
                    <div class="form-group">
                        <label for="editItemName" class="form-label">Code Title</label>
                        <input type="text" class="form-input" id="editItemName" value="${codeData.title}" required>
                    </div>
                    <div class="form-group">
                        <label for="editItemContent" class="form-label">Code Content</label>
                        <textarea class="form-input form-textarea" id="editItemContent" style="font-family: monospace;">${codeData.content}</textarea>
                    </div>
                    <input type="hidden" id="editItemLanguage" value="${languageCodeType.type}">
                    <input type="hidden" id="editItemOriginalIndex" value="${languageCodeType.indexInType}">
                `;
                break;
        }
        document.getElementById('editItemModalTitle').textContent = title;
        document.getElementById('editItemFormContainer').innerHTML = formHTML;
        editItemModal.classList.add('active');
    }
    // Helper function to map a global code index (used in search) back to a type and local index
    function getLanguageCodeType(globalIndex) {
        const codeTypes = ['pythonCodes', 'javascriptCodes', 'htmlCodes', 'cssCodes', 'otherCodes'];
        let currentIndex = globalIndex;
        for (let lang of codeTypes) {
            const data = getCodeData(lang);
            if (currentIndex < data.length) {
                return { type: lang, indexInType: currentIndex };
            }
            currentIndex -= data.length;
        }
        return { type: null, indexInType: -1 };
    }
    document.getElementById('saveEditItemBtn').addEventListener('click', async () => {
        if (currentEditType === null || currentEditItem === null) {
            showToast('Error: No item selected for editing.', 'error');
            return;
        }
        const nameInput = document.getElementById('editItemName');
        const contentInput = document.getElementById('editItemContent');
        const emailInput = document.getElementById('editItemEmail');
        const phoneInput = document.getElementById('editItemPhone');
        const notesInput = document.getElementById('editItemNotes');
        const languageInput = document.getElementById('editItemLanguage');
        const originalIndexInput = document.getElementById('editItemOriginalIndex');
        if (!nameInput || !nameInput.value.trim()) {
            showToast('Name/title cannot be empty.', 'error');
            return;
        }
        let updatedItem = null;
        let id = null;
        let success = false;
        try {
            switch(currentEditType) {
                case 'file':
                    const file = filesData[currentEditItem];
                    id = file.id;
                    updatedItem = {
                        ...file,
                        title: nameInput.value.trim(),
                        // Text files are saved back as base64 to the API endpoint
                        content: btoa(contentInput.value),
                        date: new Date().toISOString()
                    };
                    filesData[currentEditItem] = await saveItemToAPI('files', updatedItem, 'PUT', id);
                    renderFiles();
                    logActivity('edit', 'file', updatedItem.title);
                    success = true;
                    break;
                case 'note':
                    const note = notesData[currentEditItem];
                    id = note.id;
                    updatedItem = {
                        ...note,
                        title: nameInput.value.trim(),
                        content: contentInput.value,
                        date: new Date().toISOString()
                    };
                    notesData[currentEditItem] = await saveItemToAPI('notes', updatedItem, 'PUT', id);
                    renderNotes();
                    logActivity('edit', 'note', updatedItem.title);
                    success = true;
                    break;
                case 'project':
                    const project = projectsData[currentEditItem];
                    id = project.id;
                    updatedItem = {
                        ...project,
                        name: nameInput.value.trim(),
                        description: contentInput.value,
                        date: new Date().toISOString()
                    };
                    projectsData[currentEditItem] = await saveItemToAPI('projects', updatedItem, 'PUT', id);
                    renderProjects();
                    logActivity('edit', 'project', updatedItem.name);
                    success = true;
                    break;
                case 'contact':
                    const contact = contactsData[currentEditItem];
                    id = contact.id;
                    updatedItem = {
                        ...contact,
                        name: nameInput.value.trim(),
                        email: emailInput ? emailInput.value.trim() : '',
                        phone: phoneInput ? phoneInput.value.trim() : '',
                        notes: notesInput ? notesInput.value : '',
                        date: new Date().toISOString()
                    };
                    contactsData[currentEditItem] = await saveItemToAPI('contacts', updatedItem, 'PUT', id);
                    renderContacts();
                    logActivity('edit', 'contact', updatedItem.name);
                    success = true;
                    break;
                case 'code':
                    const language = languageInput.value;
                    const indexInType = parseInt(originalIndexInput.value);
                    const targetArray = getCodeData(language);
                    const item = targetArray[indexInType];
                    id = item.id;
                    updatedItem = {
                        ...item,
                        title: nameInput.value.trim(),
                        content: contentInput.value,
                        date: new Date().toISOString()
                    };
                    targetArray[indexInType] = await saveItemToAPI(language, updatedItem, 'PUT', id);
                    renderCodeSnippets();
                    logActivity('edit', language, updatedItem.title);
                    success = true;
                    break;
            }
        } catch (error) {
            // Error handling done in saveItemToAPI
            success = false;
        }
        if (success) {
            editItemModal.classList.remove('active');
            showToast('Item updated successfully.', 'success');
        }
    });
    // --- VIEW TOGGLE FUNCTIONALITY ---
    function setupViewToggle(listId, listViewBtnId, gridViewBtnId) {
        const listViewBtn = document.getElementById(listViewBtnId);
        const gridViewBtn = document.getElementById(gridViewBtnId);
        const listContainer = document.getElementById(listId);
        if (!listViewBtn || !gridViewBtn || !listContainer) return;
        if (!listContainer.classList.contains('grid-view')) {
            listViewBtn.classList.add('active');
            gridViewBtn.classList.remove('active');
        } else {
            listViewBtn.classList.remove('active');
            gridViewBtn.classList.add('active');
        }
        listViewBtn.addEventListener('click', () => {
            listViewBtn.classList.add('active');
            gridViewBtn.classList.remove('active');
            listContainer.classList.remove('grid-view');
        });
        gridViewBtn.addEventListener('click', () => {
            gridViewBtn.classList.add('active');
            listViewBtn.classList.remove('active');
            listContainer.classList.add('grid-view');
        });
    }
    setupViewToggle('filesList', 'listViewBtn', 'gridViewBtn');
    setupViewToggle('notesList', 'notesListViewBtn', 'notesGridViewBtn');
    setupViewToggle('projectsList', 'projectsListViewBtn', 'projectsGridViewBtn');
    setupViewToggle('pythonCodesList', 'pythonListViewBtn', 'pythonGridViewBtn');
    setupViewToggle('javascriptCodesList', 'jsListViewBtn', 'jsGridViewBtn');
    setupViewToggle('htmlCodesList', 'htmlListViewBtn', 'htmlGridViewBtn');
    setupViewToggle('cssCodesList', 'cssListViewBtn', 'cssGridViewBtn');
    setupViewToggle('otherCodesList', 'otherListViewBtn', 'otherGridViewBtn');
    setupViewToggle('contactsList', 'contactsListViewBtn', 'contactsGridViewBtn');
    // --- SELECT DROPDOWN & DELETE LOGIC ---
    function setupSelectDropdown(btnId, menuId, listId, itemTypeKey) {
        const selectBtn = document.getElementById(btnId);
        const selectMenu = document.getElementById(menuId);
        const listContainer = document.getElementById(listId);
        if (!selectBtn || !selectMenu || !listContainer) return;
        selectBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            document.querySelectorAll('.select-dropdown-menu').forEach(menu => {
                if (menu.id !== menuId) {
                    menu.classList.remove('active');
                }
            });
            selectMenu.classList.toggle('active');
        });
        selectMenu.addEventListener('click', (e) => {
            e.preventDefault();
            const target = e.target.closest('.select-dropdown-item');
            if (!target) return;
            const action = target.getAttribute('data-action');
            const checkboxes = listContainer.querySelectorAll('.item-checkbox');
            switch (action) {
                case 'toggle':
                    selectionMode[itemTypeKey] = !selectionMode[itemTypeKey];
                    if (selectionMode[itemTypeKey]) {
                        listContainer.classList.add('selection-mode-active');
                        selectBtn.innerHTML = 'Cancel <i class="fas fa-times"></i>';
                    } else {
                        listContainer.classList.remove('selection-mode-active');
                        selectBtn.innerHTML = 'Select <i class="fas fa-caret-down"></i>';
                    }
                    renderAll();
                    break;
                case 'all':
                    if (!selectionMode[itemTypeKey]) {
                        selectionMode[itemTypeKey] = true;
                        listContainer.classList.add('selection-mode-active');
                        selectBtn.innerHTML = 'Cancel <i class="fas fa-times"></i>';
                        renderAll();
                        setTimeout(() => {
                            listContainer.querySelectorAll('.item-checkbox').forEach(cb => cb.checked = true);
                        }, 50);
                    } else {
                        checkboxes.forEach(cb => cb.checked = true);
                    }
                    break;
                case 'none':
                    if (selectionMode[itemTypeKey]) {
                        checkboxes.forEach(cb => cb.checked = false);
                    }
                    break;
                case 'delete':
                    if (selectionMode[itemTypeKey]) {
                        deleteSelectedItems(listId, itemTypeKey);
                    } else {
                        showToast('Activate selection mode first to delete items.', 'info');
                    }
                    break;
            }
            selectMenu.classList.remove('active');
        });
    }
    async function deleteSelectedItems(listId, itemTypeKey) {
        const listContainer = document.getElementById(listId);
        const checkedBoxes = listContainer.querySelectorAll('.item-checkbox:checked');
        if (checkedBoxes.length === 0) {
            showToast('No items selected for deletion.', 'info');
            return;
        }
        const count = checkedBoxes.length;
        const itemTypeLabel = itemTypeKey
            .replace(/Codes$/, '')
            .replace(/([A-Z])/g, ' $1')
            .replace(/^./, str => str.toUpperCase());
        showConfirmation(
            'Delete Selected Items',
            `Are you sure you want to delete ${count} selected ${itemTypeLabel}(s)? This cannot be undone.`,
            async () => {
                const indicesToDelete = Array.from(checkedBoxes).map(cb => parseInt(cb.getAttribute('data-index')));
                const dataArray = getCodeData(itemTypeKey);
                let deletedNames = [];
                let deletedCount = 0;
                // Iterate backwards to safely splice the array
                for (const index of indicesToDelete.sort((a, b) => b - a)) {
                    const item = dataArray[index];
                    const id = item.id;
                    const itemName = item.title || item.name || 'Unnamed Item';
                    try {
                        await deleteItemFromAPI(itemTypeKey, id);
                        deletedNames.push(itemName);
                        dataArray.splice(index, 1);
                        deletedCount++;
                    } catch (error) {
                        showToast(`Failed to delete ${itemName}.`, 'error');
                        console.error('Delete failed for item', id, error);
                    }
                }
                showToast(`${deletedCount} item(s) deleted.`, 'success');
                deletedNames.forEach(name => logActivity('delete', itemTypeKey, name));
                // Exit selection mode and re-render
                selectionMode[itemTypeKey] = false;
                listContainer.classList.remove('selection-mode-active');
                renderAll();
            }
        );
    }
    document.addEventListener('click', () => {
        document.querySelectorAll('.select-dropdown-menu').forEach(menu => {
            menu.classList.remove('active');
        });
    });
    // === CORRECTED FILE HANDLING SECTION (using FormData and /api/files/upload) ===
    const filesList = document.getElementById('filesList');
    function processUploadedFiles(files) {
        Array.from(files).forEach(file => {
            const formData = new FormData();
            formData.append('file', file);
            formData.append('title', file.name.replace(/\.[^/.]+$/, ""));
            formData.append('description', '');
            // FIX: Correctly use API_BASE for the upload endpoint
            fetch(`${API_BASE}/files/upload`, {
                method: 'POST',
                body: formData
                // âš ï¸ DO NOT set Content-Type â€” browser sets it automatically for FormData
            })
            .then(async response => {
                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(`Upload failed: ${response.status} ${response.statusText}. Detail: ${errorText}`);
                }
                return response.json();
            })
            .then(savedFile => {
                filesData.unshift(savedFile);
                renderFiles();
                showToast('File "' + file.name + '" uploaded.', 'success');
                logActivity('create', 'file', file.name);
            })
            .catch(error => {
                console.error('File upload error:', error);
                showToast('File upload failed: ' + (error.message || 'Unknown error'), 'error');
            });
        });
    }
    if (fileUploadArea) {
        fileUploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            e.stopPropagation();
            fileUploadArea.style.backgroundColor = 'rgba(47, 132, 124, 0.2)';
        });
        fileUploadArea.addEventListener('dragleave', (e) => {
            e.preventDefault();
            e.stopPropagation();
            fileUploadArea.style.backgroundColor = 'var(--file-upload-background)';
        });
        fileUploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            e.stopPropagation();
            fileUploadArea.style.backgroundColor = 'var(--file-upload-background)';
            const droppedFiles = e.dataTransfer.files;
            if (droppedFiles.length > 0) {
                processUploadedFiles(droppedFiles);
            }
        });
        fileUploadArea.addEventListener('click', () => {
            if (fileInput) fileInput.click();
        });
    }
    if (fileInput) {
        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                processUploadedFiles(e.target.files);
            }
            e.target.value = ''; // Reset so same file can be uploaded again
        });
    }
    window.downloadFile = function(index) {
        const file = filesData[index];
        // Use the 'url' field returned by the API if available, otherwise try 'downloadUrl', then 'path'
        // This assumes your API returns a direct download URL in one of these fields.
        // Adjust the field names based on what your API actually returns.
        const downloadUrl = file.url || file.downloadUrl || file.path;
        if (!downloadUrl) {
            showToast('File download URL not available.', 'error');
            console.error('File object missing download URL:', file); // Debug log
            return;
        }
        // Ensure the URL is absolute if it starts with /, by prepending API_BASE
        // If your API returns a full URL (e.g., http://localhost:3000/files/xyz),
        // this check will be skipped correctly.
        const fullDownloadUrl = downloadUrl.startsWith('/') ? `${API_BASE}${downloadUrl}` : downloadUrl;
        const link = document.createElement('a');
        link.href = fullDownloadUrl;
        // Attempt to suggest a filename using 'originalname' or 'name' from the API response
        link.download = file.originalname || file.name || 'downloaded_file';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        showToast(`File "${file.title || file.name}" downloaded.`, 'success');
    };
    window.editFile = function(index) {
        const file = filesData[index];
        const isText = file.mimetype?.includes('text') ||
                       file.name?.endsWith('.txt') ||
                       file.name?.endsWith('.json') ||
                       file.name?.endsWith('.xml') ||
                       file.name?.endsWith('.html') ||
                       file.name?.endsWith('.css') ||
                       file.name?.endsWith('.js') ||
                       file.name?.endsWith('.py');
        if (!isText) {
            showToast('Only text-based files can be edited.', 'info');
            return;
        }
        // FIX: Actually open the edit modal for text files
        openEditModal('file', index);
    };
    window.viewFile = function(index) {
        const file = filesData[index];
        const metadata = `
            <strong>Type:</strong> ${file.mimetype || 'Unknown'}<br>
            <strong>Size:</strong> ${(file.size / 1024).toFixed(2)} KB<br>
            <strong>Uploaded:</strong> ${formatDateTime(file.date)}
        `;
        let content = "(File content is binary. Use Download to access.)";
        // Check if it's a text file and content is available (base64 encoded)
        if (file.content && (file.mimetype?.includes('text') || file.name?.match(/\.(txt|json|xml|html|css|js|py)$/i))) {
             try {
                content = atob(file.content);
             } catch (e) {
                content = "Could not decode text content.";
             }
        }
        openContentViewer(`File: ${file.title || file.name}`, metadata, content, false);
    };
    window.deleteFile = async function(index) {
        showConfirmation(
            'Delete File',
            `Are you sure you want to delete "${filesData[index].title || filesData[index].name}"?`,
            async () => {
                const file = filesData[index];
                try {
                    await deleteItemFromAPI('files', file.id);
                    filesData.splice(index, 1);
                    renderFiles();
                    showToast(`File "${file.title || file.name}" deleted.`, 'info');
                    logActivity('delete', 'file', file.title || file.name);
                } catch (error) {
                    console.error('Delete failed:', error);
                }
            }
        );
    };
    function renderFiles() {
        if (!filesList) return;
        filesList.innerHTML = '';
        if (filesData.length === 0) {
            filesList.innerHTML = `<div class="empty-state"><i class="fas fa-folder-open"></i><h3>No files yet</h3><p>Upload your first file to get started</p></div>`;
            return;
        }
        const isSelectionActive = selectionMode.files;
        const selectBtn = document.getElementById('selectFilesBtn');
        if (selectBtn) {
            selectBtn.innerHTML = isSelectionActive
                ? 'Cancel <i class="fas fa-times"></i>'
                : 'Select <i class="fas fa-caret-down"></i>';
            if (isSelectionActive) filesList.classList.add('selection-mode-active');
            else filesList.classList.remove('selection-mode-active');
        }
        filesData.forEach((file, index) => {
            let iconClass = 'fas fa-file';
            if (file.mimetype?.includes('image')) iconClass = 'fas fa-image';
            else if (file.mimetype?.includes('pdf')) iconClass = 'fas fa-file-pdf';
            else if (file.mimetype?.includes('text')) iconClass = 'fas fa-file-alt';
            else if (file.mimetype?.includes('zip')) iconClass = 'fas fa-file-archive';
            else if (file.name?.endsWith('.html') || file.name?.endsWith('.css') || file.name?.endsWith('.js') || file.name?.endsWith('.py'))
                iconClass = 'fas fa-code';
            const isTextType = file.mimetype?.includes('text') ||
                               file.name?.match(/\.(txt|json|xml|html|css|js|py)$/i);
            // Only allow editing if it is text AND the content data is present (base64)
            const isEditable = isTextType && file.content;
            const checkboxHtml = isSelectionActive
                ? `<input type="checkbox" class="item-checkbox" data-index="${index}">`
                : '';
            const displayName = file.title || file.name || 'Unnamed File';
            const fileSizeKB = (file.size / 1024).toFixed(2);
            const item = document.createElement('div');
            item.className = 'file-item fade-in-up';
            item.innerHTML = `
                ${checkboxHtml}
                <div class="file-info">
                    <div class="file-icon"><i class="${iconClass}"></i></div>
                    <div class="file-details">
                        <h4>${displayName}</h4>
                        <p>Uploaded: ${formatDateTime(file.date)} | Size: ${fileSizeKB} KB</p>
                    </div>
                </div>
                <div class="file-actions">
                    <button class="icon-btn" onclick="window.viewFile(${index})" title="View Details">
                        <i class="fas fa-eye"></i>
                    </button>
                    <button class="icon-btn" onclick="window.downloadFile(${index})" title="Download File">
                        <i class="fas fa-download"></i>
                    </button>
                    ${isEditable ? `<button class="icon-btn" onclick="window.editFile(${index})" title="Edit File"><i class="fas fa-edit"></i></button>` : ''}
                    <button class="icon-btn" onclick="window.deleteFile(${index})" title="Delete File">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            `;
            filesList.appendChild(item);
        });
        updateDashboardStats();
    }
    // --- NOTES, PROJECTS, CODE, CONTACTS remain unchanged from your original ---
    const noteTitleInput = document.getElementById('noteTitle');
    const noteContentInput = document.getElementById('noteContent');
    const saveNoteBtn = document.getElementById('saveNoteBtn');
    const notesList = document.getElementById('notesList');
    window.editNote = function(index) { openEditModal('note', index); };
    window.viewNote = function(index) {
        const note = notesData[index];
        const metadata = `<strong>Note Title:</strong> ${note.title}<br><strong>Created:</strong> ${formatDateTime(note.date)}`;
        openContentViewer(`Note: ${note.title}`, metadata, note.content);
    };
    window.downloadNote = function(index) {
        const note = notesData[index];
        const content = `Title: ${note.title}
Date: ${formatDateTime(note.date)}
---
${note.content}`;
        handleDownload(content, `${note.title.replace(/[^\w\s]/gi, '').replace(/\s/g, '_')}_note.txt`, 'text/plain');
        showToast('Note downloaded.', 'success');
    };
    window.deleteNote = async function(index) {
        showConfirmation(
            'Delete Note',
            `Are you sure you want to delete "${notesData[index].title}"?`,
            async () => {
                const note = notesData[index];
                const id = note.id;
                try {
                    await deleteItemFromAPI('notes', id);
                    notesData.splice(index, 1);
                    renderNotes();
                    showToast('Note "' + note.title + '" deleted.', 'info');
                    logActivity('delete', 'note', note.title);
                } catch (error) {
                    console.error('Delete note failed:', error);
                }
            }
        );
    };
    function renderNotes() {
      notesList.innerHTML = '';
      if (notesData.length === 0) {
        notesList.innerHTML = `<div class="empty-state"><i class="fas fa-sticky-note"></i><h3>No notes yet</h3><p>Create your first note to get started</p></div>`;
        return;
      }
      const isSelectionActive = selectionMode.notes;
      const selectBtn = document.getElementById('selectNotesBtn');
        if(selectBtn) {
            if (isSelectionActive) {
                selectBtn.innerHTML = 'Cancel <i class="fas fa-times"></i>';
                notesList.classList.add('selection-mode-active');
            } else {
                selectBtn.innerHTML = 'Select <i class="fas fa-caret-down"></i>';
                notesList.classList.remove('selection-mode-active');
            }
        }
      notesData.forEach((note, index) => {
        const item = document.createElement('div');
        item.className = 'file-item fade-in-up activity-item';
        const checkboxHtml = isSelectionActive ? `<input type="checkbox" class="item-checkbox" data-index="${index}">` : '';
        item.innerHTML = `
          ${checkboxHtml}
          <div class="file-info">
            <div class="file-icon">
              <i class="fas fa-sticky-note"></i>
            </div>
            <div class="file-details">
              <h4>${note.title}</h4>
              <p>Created: ${formatDateTime(note.date)}</p>
            </div>
          </div>
          <div class="file-actions">
            <button class="icon-btn" onclick="window.downloadNote(${index})" title="Download Note">
                <i class="fas fa-download"></i>
            </button>
            <button class="icon-btn" onclick="window.viewNote(${index})" title="View Note">
              <i class="fas fa-eye"></i>
            </button>
            <button class="icon-btn" onclick="window.editNote(${index})" title="Edit Note">
              <i class="fas fa-edit"></i>
            </button>
            <button class="icon-btn" onclick="window.deleteNote(${index})" title="Delete Note">
              <i class="fas fa-trash"></i>
            </button>
          </div>
        `;
        notesList.appendChild(item);
      });
      updateDashboardStats();
    }
    document.getElementById('clearNoteBtn').addEventListener('click', () => {
        noteTitleInput.value = '';
        noteContentInput.value = '';
        showToast('Note form cleared.', 'info');
    });
    saveNoteBtn.addEventListener('click', async () => {
      const title = noteTitleInput.value.trim();
      const content = noteContentInput.value.trim();
      if (title === '' || content === '') {
        showToast('Please enter both a title and content for your note.', 'error');
        return;
      }
      const newNote = { title, content, date: new Date().toISOString() };
      try {
        const savedNote = await saveItemToAPI('notes', newNote);
        notesData.unshift(savedNote);
        renderNotes();
        noteTitleInput.value = '';
        noteContentInput.value = '';
        showToast('Note "' + title + '" saved.', 'success');
        logActivity('create', 'note', title);
      } catch (error) {
        console.error('Save note failed:', error);
      }
    });
    // --- PROJECTS ---
    const projectNameInput = document.getElementById('projectName');
    const projectDescriptionInput = document.getElementById('projectDescription');
    const createProjectBtn = document.getElementById('createProjectBtn');
    const projectsList = document.getElementById('projectsList');
    window.editProject = function(index) { openEditModal('project', index); };
    window.viewProject = function(index) {
        const project = projectsData[index];
        const metadata = `<strong>Project Name:</strong> ${project.name}<br><strong>Last Updated:</strong> ${formatDateTime(project.date)}`;
        openContentViewer(`Project: ${project.name}`, metadata, project.description);
    };
    window.downloadProject = function(index) {
        const project = projectsData[index];
        const content = `Project Name: ${project.name}
Last Updated: ${formatDateTime(project.date)}
---
Description:
${project.description}`;
        handleDownload(content, `${project.name.replace(/[^\w\s]/gi, '').replace(/\s/g, '_')}_project.txt`, 'text/plain');
        showToast('Project details downloaded.', 'success');
    };
    window.deleteProject = async function(index) {
        showConfirmation(
            'Delete Project',
            `Are you sure you want to delete project "${projectsData[index].name}"?`,
            async () => {
                const project = projectsData[index];
                const id = project.id;
                try {
                    await deleteItemFromAPI('projects', id);
                    projectsData.splice(index, 1);
                    renderProjects();
                    showToast('Project "' + project.name + '" deleted.', 'info');
                    logActivity('delete', 'project', project.name);
                } catch (error) {
                    console.error('Delete project failed:', error);
                }
            }
        );
    };
    function renderProjects() {
      projectsList.innerHTML = '';
      if (projectsData.length === 0) {
        projectsList.innerHTML = `<div class="empty-state"><i class="fas fa-project-diagram"></i><h3>No projects yet</h3><p>Create your first project to get started</p></div>`;
        return;
      }
      const isSelectionActive = selectionMode.projects;
      const selectBtn = document.getElementById('selectProjectsBtn');
        if(selectBtn) {
            if (isSelectionActive) {
                selectBtn.innerHTML = 'Cancel <i class="fas fa-times"></i>';
                projectsList.classList.add('selection-mode-active');
            } else {
                selectBtn.innerHTML = 'Select <i class="fas fa-caret-down"></i>';
                projectsList.classList.remove('selection-mode-active');
            }
        }
      projectsData.forEach((project, index) => {
        const item = document.createElement('div');
        item.className = 'project-card fade-in-up';
        const checkboxHtml = isSelectionActive ? `<input type="checkbox" class="item-checkbox" data-index="${index}">` : '';
        item.innerHTML = `
          <div class="project-header">
            ${checkboxHtml}
            <h3 class="project-title">${project.name}</h3>
          </div>
          <div class="project-body">
            <p class="project-description">${project.description.substring(0, 100)}${project.description.length > 100 ? '...' : ''}</p>
            <div class="project-meta">
              <span><i class="fas fa-calendar-alt"></i> Last Updated: ${formatDateTime(project.date)}</span>
            </div>
            <div class="project-actions">
                <button class="btn btn-primary btn-sm" onclick="window.viewProject(${index})">
                    <i class="fas fa-eye"></i> View
                </button>
                <button class="btn btn-outline btn-sm" onclick="window.downloadProject(${index})">
                    <i class="fas fa-download"></i> Download
                </button>
                <button class="btn btn-primary btn-sm" onclick="window.editProject(${index})">
                    <i class="fas fa-edit"></i> Edit
                </button>
                <button class="btn btn-danger btn-sm" onclick="window.deleteProject(${index})">
                    <i class="fas fa-trash"></i> Delete
                </button>
            </div>
          </div>
        `;
        projectsList.appendChild(item);
      });
      updateDashboardStats();
    }
    createProjectBtn.addEventListener('click', async () => {
      if (!validateRequiredFields(["projectName", "projectDescription"])) return;
      const name = projectNameInput.value.trim();
      const description = projectDescriptionInput.value.trim();
      const newProject = { name, description, date: new Date().toISOString() };
      try {
        const savedProject = await saveItemToAPI('projects', newProject);
        projectsData.unshift(savedProject);
        renderProjects();
        projectNameInput.value = '';
        projectDescriptionInput.value = '';
        showToast('Project "' + name + '" created.', 'success');
        logActivity('create', 'project', name);
      } catch (error) {
        console.error('Create project failed:', error);
      }
    });
    // --- CODE SNIPPETS ---
    function getCodeData(type) {
        switch(type) {
            case 'files': return filesData;
            case 'notes': return notesData;
            case 'projects': return projectsData;
            case 'contacts': return contactsData;
            case 'pythonCodes': return pythonCodesData;
            case 'javascriptCodes': return jsCodesData;
            case 'htmlCodes': return htmlCodesData;
            case 'cssCodes': return cssCodesData;
            case 'otherCodes': return otherCodesData;
            default: return [];
        }
    }
    window.editCode = function(type, index) {
        const codeTypes = ['pythonCodes', 'javascriptCodes', 'htmlCodes', 'cssCodes', 'otherCodes'];
        let globalIndex = 0;
        for (let lang of codeTypes) {
            if (lang === type) {
                globalIndex += index;
                break;
            }
            globalIndex += getCodeData(lang).length;
        }
        openEditModal('code', globalIndex);
    };
    window.viewCode = function(type, index) {
        const code = getCodeData(type)[index];
        const language = type.replace('Codes', '');
        const metadata = `<strong>Language:</strong> ${language.charAt(0).toUpperCase() + language.slice(1)}<br><strong>Saved:</strong> ${formatDateTime(code.date)}`;
        openContentViewer(`Code Snippet: ${code.title}`, metadata, code.content, true);
    };
    window.downloadCode = function(type, index) {
        const code = getCodeData(type)[index];
        const language = type.replace('Codes', '');
        let extension = 'txt';
        let mimeType = 'text/plain';
        if (language === 'python') { extension = 'py'; mimeType = 'text/x-python'; }
        else if (language === 'javascript') { extension = 'js'; mimeType = 'text/javascript'; }
        else if (language === 'html') { extension = 'html'; mimeType = 'text/html'; }
        else if (language === 'css') { extension = 'css'; mimeType = 'text/css'; }
        const content = `Title: ${code.title} (Language: ${language.toUpperCase()})
Saved: ${formatDateTime(code.date)}
---
${code.content}`;
        handleDownload(content, `${code.title.replace(/[^\w\s]/gi, '').replace(/\s/g, '_')}_snippet.${extension}`, mimeType);
        showToast('Code snippet downloaded.', 'success');
    };
    window.deleteCode = async function(type, index) {
        const data = getCodeData(type);
        const code = data[index];
        showConfirmation(
            'Delete Code Snippet',
            `Are you sure you want to delete code snippet "${code.title}"?`,
            async () => {
                const id = code.id;
                try {
                    await deleteItemFromAPI(type, id);
                    data.splice(index, 1);
                    renderCodeSnippets();
                    showToast('Code snippet "' + code.title + '" deleted.', 'info');
                    logActivity('delete', type, code.title);
                } catch (error) {
                    console.error('Delete code failed:', error);
                }
            }
        );
    };
    function renderCodeSnippets() {
        const types = [
            { key: 'pythonCodes', btnId: 'selectPythonBtn', listId: 'pythonCodesList' },
            { key: 'javascriptCodes', btnId: 'selectJsBtn', listId: 'javascriptCodesList' },
            { key: 'htmlCodes', btnId: 'selectHtmlBtn', listId: 'htmlCodesList' },
            { key: 'cssCodes', btnId: 'selectCssBtn', listId: 'cssCodesList' },
            { key: 'otherCodes', btnId: 'selectOtherBtn', listId: 'otherCodesList' }
        ];
        types.forEach(typeInfo => {
            const listEl = document.getElementById(typeInfo.listId);
            if (!listEl) return;
            const data = getCodeData(typeInfo.key);
            const isSelectionActive = selectionMode[typeInfo.key];
            const language = typeInfo.key.replace('Codes', '');
            const selectBtn = document.getElementById(typeInfo.btnId);
            if(selectBtn) {
                if (isSelectionActive) {
                    selectBtn.innerHTML = 'Cancel <i class="fas fa-times"></i>';
                    listEl.classList.add('selection-mode-active');
                } else {
                    selectBtn.innerHTML = 'Select <i class="fas fa-caret-down"></i>';
                    listEl.classList.remove('selection-mode-active');
                }
            }
            listEl.innerHTML = '';
            if (data.length === 0) {
                listEl.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-code"></i>
                        <h3>No ${language.charAt(0).toUpperCase() + language.slice(1)} codes yet</h3>
                        <p>Add your first ${language} code snippet to get started</p>
                    </div>
                `;
                return;
            }
            data.forEach((code, index) => {
                const item = document.createElement('div');
                item.className = 'file-item fade-in-up activity-item';
                const checkboxHtml = isSelectionActive ? `<input type="checkbox" class="item-checkbox" data-index="${index}">` : '';
                item.innerHTML = `
                  ${checkboxHtml}
                  <div class="file-info">
                    <div class="file-icon">
                      <i class="fas fa-code"></i>
                    </div>
                    <div class="file-details">
                      <h4>${code.title}</h4>
                      <p>Saved: ${formatDateTime(code.date)}</p>
                    </div>
                  </div>
                  <div class="file-actions">
                    <button class="icon-btn" onclick="window.downloadCode('${typeInfo.key}', ${index})" title="Download Code">
                        <i class="fas fa-download"></i>
                    </button>
                    <button class="icon-btn" onclick="window.viewCode('${typeInfo.key}', ${index})" title="View Code">
                      <i class="fas fa-eye"></i>
                    </button>
                    <button class="icon-btn" onclick="window.editCode('${typeInfo.key}', ${index})" title="Edit Code">
                      <i class="fas fa-edit"></i>
                    </button>
                    <button class="icon-btn" onclick="window.deleteCode('${typeInfo.key}', ${index})" title="Delete Code">
                      <i class="fas fa-trash"></i>
                    </button>
                  </div>
                `;
                listEl.appendChild(item);
            });
        });
        updateDashboardStats();
    }
    // Code save handlers
    document.getElementById('savePythonCodeBtn').addEventListener('click', async () => {
        const title = document.getElementById('pythonCodeTitle').value.trim();
        const content = document.getElementById('pythonCodeContent').value.trim();
        if (title === '' || content === '') {
            showToast('Please enter both a title and code content.', 'error');
            return;
        }
        const newCode = { title, content, date: new Date().toISOString() };
        try {
            const saved = await saveItemToAPI('pythonCodes', newCode);
            pythonCodesData.unshift(saved);
            renderCodeSnippets();
            document.getElementById('pythonCodeTitle').value = '';
            document.getElementById('pythonCodeContent').value = '';
            showToast('Python code snippet saved.', 'success');
            logActivity('create', 'pythonCodes', title);
        } catch (error) {
            console.error('Save Python code failed:', error);
        }
    });
    document.getElementById('saveJsCodeBtn').addEventListener('click', async () => {
        const title = document.getElementById('jsCodeTitle').value.trim();
        const content = document.getElementById('jsCodeContent').value.trim();
        if (title === '' || content === '') {
            showToast('Please enter both a title and code content.', 'error');
            return;
        }
        const newCode = { title, content, date: new Date().toISOString() };
        try {
            const saved = await saveItemToAPI('javascriptCodes', newCode);
            jsCodesData.unshift(saved);
            renderCodeSnippets();
            document.getElementById('jsCodeTitle').value = '';
            document.getElementById('jsCodeContent').value = '';
            showToast('JavaScript code snippet saved.', 'success');
            logActivity('create', 'javascriptCodes', title);
        } catch (error) {
            console.error('Save JS code failed:', error);
        }
    });
    document.getElementById('saveHtmlCodeBtn').addEventListener('click', async () => {
        const title = document.getElementById('htmlCodeTitle').value.trim();
        const content = document.getElementById('htmlCodeContent').value.trim();
        if (title === '' || content === '') {
            showToast('Please enter both a title and code content.', 'error');
            return;
        }
        const newCode = { title, content, date: new Date().toISOString() };
        try {
            const saved = await saveItemToAPI('htmlCodes', newCode);
            htmlCodesData.unshift(saved);
            renderCodeSnippets();
            document.getElementById('htmlCodeTitle').value = '';
            document.getElementById('htmlCodeContent').value = '';
            showToast('HTML code snippet saved.', 'success');
            logActivity('create', 'htmlCodes', title);
        } catch (error) {
            console.error('Save HTML code failed:', error);
        }
    });
    document.getElementById('saveCssCodeBtn').addEventListener('click', async () => {
        const title = document.getElementById('cssCodeTitle').value.trim();
        const content = document.getElementById('cssCodeContent').value.trim();
        if (title === '' || content === '') {
            showToast('Please enter both a title and code content.', 'error');
            return;
        }
        const newCode = { title, content, date: new Date().toISOString() };
        try {
            const saved = await saveItemToAPI('cssCodes', newCode);
            cssCodesData.unshift(saved);
            renderCodeSnippets();
            document.getElementById('cssCodeTitle').value = '';
            document.getElementById('cssCodeContent').value = '';
            showToast('CSS code snippet saved.', 'success');
            logActivity('create', 'cssCodes', title);
        } catch (error) {
            console.error('Save CSS code failed:', error);
        }
    });
    document.getElementById('saveOtherCodeBtn').addEventListener('click', async () => {
        const title = document.getElementById('otherCodeTitle').value.trim();
        const content = document.getElementById('otherCodeContent').value.trim();
        if (title === '' || content === '') {
            showToast('Please enter both a title and code content.', 'error');
            return;
        }
        const newCode = { title, content, date: new Date().toISOString() };
        try {
            const saved = await saveItemToAPI('otherCodes', newCode);
            otherCodesData.unshift(saved);
            renderCodeSnippets();
            document.getElementById('otherCodeTitle').value = '';
            document.getElementById('otherCodeContent').value = '';
            showToast('Other code snippet saved.', 'success');
            logActivity('create', 'otherCodes', title);
        } catch (error) {
            console.error('Save Other code failed:', error);
        }
    });
    document.getElementById('clearPythonCodeBtn').addEventListener('click', () => {
      document.getElementById('pythonCodeTitle').value = '';
      document.getElementById('pythonCodeContent').value = '';
      showToast('Python code form cleared.', 'info');
    });
    document.getElementById('clearJsCodeBtn').addEventListener('click', () => {
      document.getElementById('jsCodeTitle').value = '';
      document.getElementById('jsCodeContent').value = '';
      showToast('JavaScript code form cleared.', 'info');
    });
    document.getElementById('clearHtmlCodeBtn').addEventListener('click', () => {
      document.getElementById('htmlCodeTitle').value = '';
      document.getElementById('htmlCodeContent').value = '';
      showToast('HTML code form cleared.', 'info');
    });
    document.getElementById('clearCssCodeBtn').addEventListener('click', () => {
      document.getElementById('cssCodeTitle').value = '';
      document.getElementById('cssCodeContent').value = '';
      showToast('CSS code form cleared.', 'info');
    });
    document.getElementById('clearOtherCodeBtn').addEventListener('click', () => {
      document.getElementById('otherCodeTitle').value = '';
      document.getElementById('otherCodeContent').value = '';
      showToast('Other code form cleared.', 'info');
    });
    // --- CONTACTS ---
    const contactNameInput = document.getElementById('contactName');
    const contactEmailInput = document.getElementById('contactEmail');
    const contactPhoneInput = document.getElementById('contactPhone');
    const contactNotesInput = document.getElementById('contactNotes');
    const saveContactBtn = document.getElementById('saveContactBtn');
    const contactsList = document.getElementById('contactsList');
    window.editContact = function(index) { openEditModal('contact', index); };
    window.viewContact = function(index) {
        const contact = contactsData[index];
        const metadata = `<strong>Name:</strong> ${contact.name}<br><strong>Email:</strong> ${contact.email || 'N/A'}<br><strong>Phone:</strong> ${contact.phone || 'N/A'}<br><strong>Added:</strong> ${formatDateTime(contact.date)}`;
        openContentViewer(`Contact: ${contact.name}`, metadata, contact.notes || 'No additional notes.');
    };
    window.downloadContact = function(index) {
        const contact = contactsData[index];
        const content = `Contact Name: ${contact.name}
Email: ${contact.email || 'N/A'}
Phone: ${contact.phone || 'N/A'}
Added: ${formatDateTime(contact.date)}
Notes:
${contact.notes || 'No additional notes.'}`;
        handleDownload(content, `${contact.name.replace(/[^\w\s]/gi, '').replace(/\s/g, '_')}_contact.txt`, 'text/plain');
        showToast('Contact details downloaded.', 'success');
    };
    window.deleteContact = async function(index) {
        showConfirmation(
            'Delete Contact',
            `Are you sure you want to delete contact "${contactsData[index].name}"?`,
            async () => {
                const contact = contactsData[index];
                const id = contact.id;
                try {
                    await deleteItemFromAPI('contacts', id);
                    contactsData.splice(index, 1);
                    renderContacts();
                    showToast('Contact "' + contact.name + '" deleted.', 'info');
                    logActivity('delete', 'contact', contact.name);
                } catch (error) {
                    console.error('Delete contact failed:', error);
                }
            }
        );
    };
    function renderContacts() {
        contactsList.innerHTML = '';
        if (contactsData.length === 0) {
            contactsList.innerHTML = `<div class="empty-state"><i class="fas fa-address-book"></i><h3>No contacts yet</h3><p>Add your first contact to get started</p></div>`;
            return;
        }
        const isSelectionActive = selectionMode.contacts;
        const selectBtn = document.getElementById('selectContactsBtn');
        if(selectBtn) {
            if (isSelectionActive) {
                selectBtn.innerHTML = 'Cancel <i class="fas fa-times"></i>';
                contactsList.classList.add('selection-mode-active');
            } else {
                selectBtn.innerHTML = 'Select <i class="fas fa-caret-down"></i>';
                contactsList.classList.remove('selection-mode-active');
            }
        }
        contactsData.forEach((contact, index) => {
            const item = document.createElement('div');
            item.className = 'file-item fade-in-up activity-item';
            const checkboxHtml = isSelectionActive ? `<input type="checkbox" class="item-checkbox" data-index="${index}">` : '';
            item.innerHTML = `
              ${checkboxHtml}
              <div class="file-info">
                <div class="file-icon">
                  <i class="fas fa-user-circle"></i>
                </div>
                <div class="file-details">
                  <h4>${contact.name}</h4>
                  <p>Added: ${formatDateTime(contact.date)} | Email: ${contact.email || 'N/A'}</p>
                </div>
              </div>
              <div class="file-actions">
                <button class="icon-btn" onclick="window.downloadContact(${index})" title="Download Contact">
                    <i class="fas fa-download"></i>
                </button>
                <button class="icon-btn" onclick="window.viewContact(${index})" title="View Contact">
                  <i class="fas fa-eye"></i>
                </button>
                <button class="icon-btn" onclick="window.editContact(${index})" title="Edit Contact">
                  <i class="fas fa-edit"></i>
                </button>
                <button class="icon-btn" onclick="window.deleteContact(${index})" title="Delete Contact">
                  <i class="fas fa-trash"></i>
                </button>
              </div>
            `;
            contactsList.appendChild(item);
        });
        updateDashboardStats();
    }
    saveContactBtn.addEventListener('click', async () => {
        if (!validateRequiredFields(["contactName","contactEmail","contactPhone","contactNotes"])) return;
        const name = contactNameInput.value.trim();
        const email = contactEmailInput.value.trim();
        const phone = contactPhoneInput.value.trim();
        const notes = contactNotesInput.value.trim();
        const newContact = { name, email, phone, notes, date: new Date().toISOString() };
        try {
            const saved = await saveItemToAPI('contacts', newContact);
            contactsData.unshift(saved);
            renderContacts();
            contactNameInput.value = '';
            contactEmailInput.value = '';
            contactPhoneInput.value = '';
            contactNotesInput.value = '';
            showToast('Contact "' + name + '" saved.', 'success');
            logActivity('create', 'contact', name);
        } catch (error) {
            console.error('Save contact failed:', error);
        }
    });
    document.getElementById('clearContactBtn').addEventListener('click', () => {
        contactNameInput.value = '';
        contactEmailInput.value = '';
        contactPhoneInput.value = '';
        contactNotesInput.value = '';
    });
    function renderAll() {
        renderNotes();
        renderFiles();
        renderProjects();
        renderCodeSnippets();
        renderContacts();
    }
    // --- INIT ---
    document.addEventListener('DOMContentLoaded', async () => {
        const themeToggleBtn = document.getElementById('themeToggle');
        const darkModeSwitch = document.getElementById('darkModeSwitch');
        if (localStorage.getItem('theme') === 'dark') {
            body.classList.add('dark-mode');
            if (darkModeSwitch) darkModeSwitch.checked = true;
        }
        const isDarkMode = body.classList.contains('dark-mode');
        const themeIcon = themeToggleBtn.querySelector('i');
        if (themeIcon) themeIcon.className = isDarkMode ? 'fas fa-sun' : 'fas fa-moon';
        loadProfilePicture();
        const isLoggedIn = localStorage.getItem('isLoggedIn') === 'true';
        if (isLoggedIn) {
            updateAuthUI(true, 'saikambala');
            body.classList.add('logged-in');
        } else {
            updateAuthUI(false, '');
            document.getElementById('loginPortal').classList.add('active');
        }
        // Setup select dropdowns
        setupSelectDropdown('selectFilesBtn', 'selectFilesMenu', 'filesList', 'files');
        setupSelectDropdown('selectNotesBtn', 'selectNotesMenu', 'notesList', 'notes');
        setupSelectDropdown('selectProjectsBtn', 'selectProjectsMenu', 'projectsList', 'projects');
        setupSelectDropdown('selectPythonBtn', 'selectPythonMenu', 'pythonCodesList', 'pythonCodes');
        setupSelectDropdown('selectJsBtn', 'selectJsMenu', 'javascriptCodesList', 'javascriptCodes');
        setupSelectDropdown('selectHtmlBtn', 'selectHtmlMenu', 'htmlCodesList', 'htmlCodes');
        setupSelectDropdown('selectCssBtn', 'selectCssMenu', 'cssCodesList', 'cssCodes');
        setupSelectDropdown('selectOtherBtn', 'selectOtherMenu', 'otherCodesList', 'otherCodes');
        setupSelectDropdown('selectContactsBtn', 'selectContactsMenu', 'contactsList', 'contacts');
        // Load all data from API in PARALLEL (Much faster)
        try {
            // This fires all requests simultaneously
            const [
                files, notes, projects, contacts,
                pyCodes, jsCodes, htCodes, cssCodes, othCodes
            ] = await Promise.all([
                loadDataFromAPI('files'),
                loadDataFromAPI('notes'),
                loadDataFromAPI('projects'),
                loadDataFromAPI('contacts'),
                loadDataFromAPI('pythonCodes'),
                loadDataFromAPI('javascriptCodes'),
                loadDataFromAPI('htmlCodes'),
                loadDataFromAPI('cssCodes'),
                loadDataFromAPI('otherCodes')
            ]);
            // Assign the results
            filesData = files;
            notesData = notes;
            projectsData = projects;
            contactsData = contacts;
            pythonCodesData = pyCodes;
            jsCodesData = jsCodes;
            htmlCodesData = htCodes;
            cssCodesData = cssCodes;
            otherCodesData = othCodes;
        } catch (error) {
            console.error(error);
            showToast('Failed to load data from server. Please check your connection.', 'error');
        }
        renderAll();
        updateDashboardStats();
        renderRecentActivity();
        document.getElementById('clearActivityBtn').addEventListener('click', clearRecentActivity);
    });
    // Theme toggle
    document.getElementById('themeToggle').addEventListener('click', () => {
        body.classList.toggle('dark-mode');
        const isDarkMode = body.classList.contains('dark-mode');
        localStorage.setItem('theme', isDarkMode ? 'dark' : 'light');
        document.getElementById('themeToggle').querySelector('i').className = isDarkMode ? 'fas fa-sun' : 'fas fa-moon';
        const darkModeSwitch = document.getElementById('darkModeSwitch');
        if(darkModeSwitch) darkModeSwitch.checked = isDarkMode;
        showToast('Theme switched to ' + (isDarkMode ? 'Dark Mode' : 'Light Mode'), 'info');
    });
    document.getElementById('darkModeSwitch')?.addEventListener('change', function() {
        body.classList.toggle('dark-mode', this.checked);
        localStorage.setItem('theme', this.checked ? 'dark' : 'light');
        document.getElementById('themeToggle').querySelector('i').className = this.checked ? 'fas fa-sun' : 'fas fa-moon';
        showToast('Theme switched.', 'info');
    });
    const animationsToggle = document.getElementById('animationsToggle');
    animationsToggle?.addEventListener('change', function() {
        if (this.checked) {
            body.classList.add('no-animations');
        } else {
            body.classList.remove('no-animations');
        }
        showToast('Animations preference updated.', 'info');
    });
    document.querySelectorAll('#codesPage .tabs .tab').forEach(tab => {
        tab.addEventListener('click', function() {
            document.querySelectorAll('#codesPage .tabs .tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('#codesPage .tab-content').forEach(c => c.classList.remove('active'));
            this.classList.add('active');
            document.getElementById(this.getAttribute('data-tab') + '-tab').classList.add('active');
        });
    });
    window.downloadFile = function(index) {
        // 1. Get the file object from the global data array
        // Assuming 'filesData' holds the list of uploaded files from the server.
        const file = filesData[index];
        if (file && file.id) {
            // 2. FOR UPLOADED FILES: Redirect to the server's download route.
            // This relies on the server (server.js) to set the Content-Disposition header.
            window.location.href = `/api/files/download/${file.id}`;
            showToast(`Download of "${file.title || file.originalname}" started.`, 'info');
        } else {
            // 3. FALLBACK/ERROR: Log and toast if the file or its ID is missing.
            console.error('Download failed: File object missing ID or index is invalid.', file);
            showToast('Error: File data missing for download. Cannot start download.', 'error');
        }
    };
  </script>

<script>
// === Added Enhancements ===

// Confirmation modal function
function showConfirmation(title, message, yesCallback) {
  const modal = document.getElementById("confirmationModal");
  if(!modal) return alert(message);

  document.getElementById("confirmationModalTitle").innerText = title;
  document.getElementById("confirmationModalMessage").innerText = message;

  modal.classList.add("active");

  const yesBtn = document.getElementById("confirmYesBtn");
  yesBtn.onclick = () => {
    modal.classList.remove("active");
    yesCallback();
  };
}

// Logout confirmation
document.addEventListener("DOMContentLoaded", () => {
  const logoutBtn = document.getElementById("menuLogoutBtn");
  if (logoutBtn) {
    logoutBtn.addEventListener("click", () => {
      showConfirmation(
        "Logout",
        "Are you sure you want to logout?",
        () => {
          document.body.classList.remove("logged-in");
          document.getElementById("loginPortal").classList.add("active");
          showToast("Logged out successfully", "info");
        }
      );
    });
  }

  // Phone only numbers
  const phone = document.getElementById("contactPhone");
  if (phone) {
    phone.addEventListener("input", e => {
      e.target.value = e.target.value.replace(/[^0-9]/g, "");
    });
  }

  // Close selection mode when dashboard clicked
  const dashBtn = document.querySelector("[data-page='dashboard']");
  if (dashBtn) {
    dashBtn.addEventListener("click", () => {
      document.querySelectorAll(".selection-mode-active").forEach(el => {
        el.classList.remove("selection-mode-active");
      });
      document.querySelectorAll(".item-checkbox").forEach(cb => {
        cb.checked = false;
      });
    });
  }

});
</script>


<script>
// === Added Validation & Selection Reset ===
function validateRequiredFields(fields) {
  for (let f of fields) {
    const el = document.getElementById(f);
    if (!el || el.value.trim() === "") {
      showToast("Please fill all required fields before saving.", "error");
      if (el) el.focus();
      return false;
    }
  }
  return true;
}

function resetSelectionMode() {
  document.querySelectorAll(".selection-mode-active").forEach(el => {
      el.classList.remove("selection-mode-active");
  });

  document.body.classList.remove("selection-mode-active");

  document.querySelectorAll(".item-checkbox").forEach(cb => cb.checked = false);

  document.querySelectorAll(".select-dropdown-menu").forEach(menu => {
      menu.classList.remove("active");
  });
}
</script>


<!-- Added new selection reset logic -->
<script>
function resetSelectionMode() {
  Object.keys(selectionMode).forEach(key => {
    selectionMode[key] = false;
  });

  document.querySelectorAll('.file-list').forEach(list => {
    list.classList.remove('selection-mode-active');
  });

  document.querySelectorAll('.item-checkbox').forEach(cb => {
    cb.checked = false;
  });

  const buttonIds = [
    'selectFilesBtn', 
    'selectNotesBtn', 
    'selectProjectsBtn', 
    'selectPythonBtn', 
    'selectJsBtn', 
    'selectHtmlBtn', 
    'selectCssBtn', 
    'selectOtherBtn', 
    'selectContactsBtn'
  ];

  buttonIds.forEach(id => {
    const btn = document.getElementById(id);
    if (btn) {
      btn.innerHTML = 'Select <i class="fas fa-caret-down"></i>';
    }
  });

  document.querySelectorAll(".select-dropdown-menu").forEach(menu => {
    menu.classList.remove("active");
  });
}

// Additional navItem handler to ensure resetSelectionMode is triggered
document.querySelectorAll(".nav-item").forEach(item => {
  item.addEventListener("click", (e) => {
    e.preventDefault();
    resetSelectionMode();
    navigateToPage(item.getAttribute("data-page"));
  });
});
</script>

</body>
</html>